<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Omni Logic V47 - Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pyidaungsu:wght@400;700&display=swap');
        body { font-family: 'Pyidaungsu', sans-serif; background-color: #020b1a; color: white; overflow: hidden; touch-action: manipulation; }
        
        /* Header & Glassmorphism */
        .fixed-header { position: fixed; top: 0; left: 0; right: 0; z-index: 100; background: rgba(2, 11, 26, 0.95); backdrop-filter: blur(10px); padding: 10px; border-bottom: 1px solid rgba(0, 207, 213, 0.3); }
        .box-p, .box-e, .box-s { width: 42px; height: 42px; font-size: 18px; display: flex; align-items: center; justify-content: center; background: #fff; font-weight: 900; margin: 0 auto; transition: all 0.3s; }
        .box-p { border-radius: 50%; color: #ff4136; box-shadow: 0 0 10px rgba(255,65,54,0.3); }
        .box-e { border-radius: 8px; color: #b10dc9; box-shadow: 0 0 10px rgba(177,13,201,0.3); }
        .box-s { border-radius: 4px; color: #2ecc40; transform: rotate(45deg); box-shadow: 0 0 10px rgba(46,204,64,0.3); }

        /* Win Rate Bars */
        .rate-container { margin-top: 6px; text-align: center; }
        .rate-bar { width: 100%; height: 3px; background: #111; border-radius: 2px; margin-top: 2px; overflow: hidden; }
        .rate-fill { height: 100%; width: 0%; transition: width 0.5s ease-in-out; }

        /* Main Scroll & Cards */
        .main-scroll { margin-top: 230px; height: calc(100vh - 230px); overflow-y: auto; padding: 12px; }
        .roll-card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(0, 207, 213, 0.2); border-radius: 16px; margin-bottom: 12px; overflow: hidden; }
        .card-header { padding: 8px 12px; background: rgba(0, 207, 213, 0.1); display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .card-body { padding: 10px; display: block; }
        
        /* Grid Alignment */
        .table-grid { display: grid; grid-template-columns: 40px 1fr 40px; align-items: center; text-align: center; font-size: 14px; }
        .pes-cols { display: grid; grid-template-columns: 1fr 1fr 1fr; }
        .row-item { padding: 6px 0; border-bottom: 1px solid rgba(255,255,255,0.03); }

        /* Floating Marker Style */
        #floating-box { 
            position: fixed; right: 15px; bottom: 90px; width: 170px; 
            background: rgba(0, 29, 61, 0.95); border: 2px solid #ffdc00; 
            border-radius: 16px; padding: 12px; z-index: 500; display: none; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.5); backdrop-filter: blur(5px);
        }
        #float-symbols { display: flex; flex-wrap: wrap; gap: 4px; justify-content: center; margin-top: 8px; font-size: 16px; }

        .stg-btn { width: 30px; height: 30px; border-radius: 8px; background: #1a3a5a; color: #00cfd5; font-weight: 900; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 12px; margin: 0 auto; }
        .stg-start { background: #2ecc40 !important; color: #fff; box-shadow: 0 0 10px #2ecc40; }
        .stg-end { background: #ff4136 !important; color: #fff; box-shadow: 0 0 10px #ff4136; }
    </style>
</head>
<body>

    <div id="logic-picker" class="fixed inset-0 bg-black/80 z-[1000] hidden flex items-center justify-center">
        <div class="bg-[#001d3d] p-6 rounded-2xl border-2 border-cyan-400 text-center w-64">
            <h3 class="text-yellow-400 font-black mb-4 text-xs tracking-widest uppercase">Select Logic</h3>
            <div class="flex justify-around mb-4">
                <button onclick="applyFloating('P')" class="bg-red-500 w-14 h-14 rounded-xl font-black text-xl shadow-lg">P</button>
                <button onclick="applyFloating('E')" class="bg-purple-500 w-14 h-14 rounded-xl font-black text-xl shadow-lg">E</button>
                <button onclick="applyFloating('S')" class="bg-green-500 w-14 h-14 rounded-xl font-black text-xl shadow-lg">S</button>
            </div>
            <button onclick="clearMark()" class="text-gray-400 text-[10px] uppercase font-bold">Cancel</button>
        </div>
    </div>

    <div id="floating-box">
        <div class="flex justify-between items-center border-b border-gray-700 pb-2">
            <span id="float-title" class="text-[10px] font-black text-yellow-400 italic"></span>
            <button onclick="clearMark()" class="text-red-500 font-black">‚úï</button>
        </div>
        <div id="float-symbols"></div>
    </div>

    <div class="fixed-header">
        <div class="grid grid-cols-3 gap-2 mb-3">
            <div class="rate-container">
                <div class="box-p" id="box-p">-</div>
                <div class="text-[10px] mt-1 font-bold text-gray-400">WIN: <span id="p-val" class="text-red-400">0%</span></div>
                <div class="rate-bar"><div id="p-bar" class="rate-fill bg-red-500"></div></div>
            </div>
            <div class="rate-container">
                <div class="box-e" id="box-e">-</div>
                <div class="text-[10px] mt-1 font-bold text-gray-400">WIN: <span id="e-val" class="text-purple-400">0%</span></div>
                <div class="rate-bar"><div id="e-bar" class="rate-fill bg-purple-500"></div></div>
            </div>
            <div class="rate-container">
                <div class="box-s" id="box-s">-</div>
                <div class="text-[10px] mt-1 font-bold text-gray-400">WIN: <span id="s-val" class="text-green-400">0%</span></div>
                <div class="rate-bar"><div id="s-bar" class="rate-fill bg-green-500"></div></div>
            </div>
        </div>
        
        <div class="flex gap-2 bg-black/40 p-2 rounded-2xl border border-white/5">
            <input type="tel" id="digit-input" class="w-20 h-12 bg-white rounded-xl text-center text-3xl font-black text-black border-2 border-cyan-400 shadow-inner" maxlength="1">
            <button onclick="submitDigit()" class="flex-1 bg-cyan-500 text-black rounded-xl font-black text-sm shadow-lg active:scale-95 transition-transform">SUBMIT</button>
        </div>
        <div id="warning-bar" class="mt-2 text-[11px] text-center font-bold text-gray-500 h-4 uppercase italic">Market Stable</div>
    </div>

    <div class="main-scroll" id="history-container"></div>

    <script>
        let history = [], phiRecords = [], roll = 1, stage = 1;
        let pNext = "-", eNext = "-", sNext = "-", markS = null, markE = null;

        function submitDigit() {
            const input = document.getElementById('digit-input');
            const val = parseInt(input.value);
            if (isNaN(val)) return;
            const grp = val >= 5 ? 'B' : 'S';
            
            const entry = { id: Date.now(), val, grp, roll, stage, p: pNext, pOk: pNext===grp, e: eNext, eOk: eNext===grp, s: sNext, sOk: sNext===grp };
            history.push(entry);
            
            checkWarning(entry);
            if (stage === 10) { roll++; stage = 1; } else { stage++; }
            
            updatePredictions(val);
            calculateWinRates();
            renderUI();
            input.value = ""; input.focus();
            localStorage.setItem('V47_PRO_DATA', JSON.stringify({history, roll, stage}));
        }

        function calculateWinRates() {
            const last20 = history.slice(-20);
            ['p', 'e', 's'].forEach(key => {
                const total = last20.filter(h => h[key] !== '-').length;
                const hits = last20.filter(h => h[key] !== '-' && h[key+'Ok']).length;
                const rate = total ? Math.round((hits/total)*100) : 0;
                document.getElementById(`${key}-val`).innerText = rate + "%";
                document.getElementById(`${key}-bar`).style.width = rate + "%";
            });
        }

        function toggleMark(id) {
            const idx = history.findIndex(h => h.id === id);
            if (markS === null || (markS !== null && markE !== null)) {
                markS = idx; markE = null;
            } else {
                markE = idx;
                const range = [markS, markE].sort((a,b)=>a-b);
                markS = range[0]; markE = range[1];
                document.getElementById('logic-picker').style.display = 'flex';
            }
            renderUI();
        }

        function applyFloating(type) {
            const sub = history.slice(markS, markE + 1);
            const html = sub.map(h => `<span>${(type==='P'?h.pOk:type==='E'?h.eOk:h.sOk)?'‚úÖ':'‚ùå'}</span>`).join('');
            document.getElementById('float-title').innerText = type + "-PATTERN";
            document.getElementById('float-symbols').innerHTML = html;
            document.getElementById('floating-box').style.display = 'block';
            document.getElementById('logic-picker').style.display = 'none';
        }

        function clearMark() {
            markS = null; markE = null;
            document.getElementById('floating-box').style.display = 'none';
            document.getElementById('logic-picker').style.display = 'none';
            renderUI();
        }

        function renderUI() {
            const container = document.getElementById('history-container');
            const groups = history.reduce((acc, cur) => { if (!acc[cur.roll]) acc[cur.roll] = []; acc[cur.roll].push(cur); return acc; }, {});
            
            container.innerHTML = Object.keys(groups).reverse().map(r => `
                <div class="roll-card">
                    <div class="card-header" onclick="this.nextElementSibling.classList.toggle('hidden')">
                        <span class="text-[10px] font-black text-cyan-400">ROLL ${r}</span>
                        <span class="text-[10px] text-gray-500">${r == roll ? 'ACTIVE üü¢' : 'CLOSED'}</span>
                    </div>
                    <div class="card-body ${r == roll ? '' : 'hidden'}">
                        <div class="table-grid text-[10px] font-bold text-gray-600 mb-2 border-b border-white/5 pb-1">
                            <div>STG</div><div class="pes-cols"><span>P</span><span>E</span><span>S</span></div><div>VAL</div>
                        </div>
                        ${groups[r].map(i => {
                            const idx = history.findIndex(h => h.id === i.id);
                            let stgClass = (idx === markS) ? "stg-start" : (idx === markE ? "stg-end" : "");
                            return `
                            <div class="row-item ${markE!==null && idx>=markS && idx<=markE ? 'bg-cyan-500/10' : ''}">
                                <div class="table-grid">
                                    <div onclick="toggleMark(${i.id})" class="stg-btn ${stgClass}">${i.stage}</div>
                                    <div class="pes-cols text-lg font-black tracking-tighter">
                                        <span class="${i.pOk?'text-green-500':'text-red-500'}">${i.p}${i.pOk?'‚úÖ':'‚ùå'}</span>
                                        <span class="${i.eOk?'text-green-500':'text-red-500'}">${i.e}${i.eOk?'‚úÖ':'‚ùå'}</span>
                                        <span class="${i.sOk?'text-green-500':'text-red-500'}">${i.s}${i.sOk?'‚úÖ':'‚ùå'}</span>
                                    </div>
                                    <div class="w-7 h-7 bg-yellow-400 text-black rounded-full flex items-center justify-center font-black text-sm mx-auto shadow-md">${i.val}</div>
                                </div>
                            </div>`;
                        }).join('')}
                    </div>
                </div>`).join('');
        }

        function checkWarning(entry) {
            const seq = history.slice(-8).map(h => h.grp).join('');
            const bar = document.getElementById('warning-bar');
            if (seq.match(/B{6,}|S{6,}/)) {
                bar.innerText = "‚ö†Ô∏è STREAK DETECTED!"; bar.classList.add('text-red-500');
            } else {
                bar.innerText = "Market Stable"; bar.classList.remove('text-red-500');
            }
        }

        function updatePredictions(last) {
            pNext = (last % 2 === 0) ? 'S' : 'B';
            if (history.length >= 3) {
                const s3 = history.slice(-3).reduce((a, b) => a + b.val, 0);
                eNext = (s3 % 2 === 0) ? 'S' : 'B';
            }
            if (history.length >= 5) {
                let dSum = history.slice(-5).reduce((a, b) => a + b.val, 0);
                while (dSum >= 10) dSum = dSum.toString().split('').map(Number).reduce((a, b) => a + b, 0);
                sNext = (dSum % 2 !== 0) ? 'B' : 'S';
            }
            document.getElementById('box-p').innerText = pNext;
            document.getElementById('box-e').innerText = eNext;
            document.getElementById('box-s').innerText = sNext;
        }

        window.onload = () => {
            const saved = JSON.parse(localStorage.getItem('V47_PRO_DATA'));
            if (saved) {
                history = saved.history || []; roll = saved.roll || 1; stage = saved.stage || 1;
                if (history.length) { updatePredictions(history[history.length-1].val); calculateWinRates(); renderUI(); }
            }
        };
    </script>
</body>
</html>
