<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Omni Logic Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pyidaungsu:wght@400;700&display=swap');
        body { font-family: 'Pyidaungsu', sans-serif; background-color: #010814; color: white; overflow: hidden; height: 100vh; margin: 0; }
        
        #login-overlay { position: fixed; inset: 0; background: rgba(1, 8, 20, 0.98); backdrop-filter: blur(15px); z-index: 1000; display: flex; align-items: center; justify-content: center; }
        .login-card { background: rgba(10, 25, 47, 0.8); border: 2px solid #00f2ff; border-radius: 24px; padding: 40px 20px; width: 90%; max-width: 360px; text-align: center; box-shadow: 0 0 40px rgba(0, 242, 255, 0.2); }
        .login-card input { background: #000; border: 1px solid #1e40af; border-radius: 12px; padding: 15px; width: 100%; color: #00f2ff; text-align: center; font-size: 20px; font-weight: bold; outline: none; transition: 0.3s; }
        .verify-btn { background: linear-gradient(90deg, #00f2ff, #0077ff); color: #000; font-weight: 900; padding: 15px; border-radius: 12px; width: 100%; margin-top: 20px; cursor: pointer; text-transform: uppercase; }
        
        .brand-title { font-size: 16px; font-weight: 900; background: linear-gradient(90deg, #00f2ff, #0077ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-transform: uppercase; }

        .fixed-header { position: fixed; top: 0; left: 0; right: 0; z-index: 100; background: #010814; padding: 10px; border-bottom: 2px solid #00f2ff; height: 350px; }
        .p-box { width: 42px; height: 42px; display: flex; align-items: center; justify-content: center; background: #fff; font-weight: 900; margin: 0 auto; font-size: 18px; border: 4px solid; }
        .a-box { border-color: #ff4136; color: #ff4136; border-radius: 50%; }
        .b-box { border-color: #b10dc9; color: #b10dc9; border-radius: 8px; }
        .c-box { border-color: #2ecc40; color: #2ecc40; border-radius: 4px; transform: rotate(45deg); }
        .c-box span { transform: rotate(-45deg); display: inline-block; }
        
        .glow-ai { box-shadow: 0 0 20px #00f2ff; border-color: #00f2ff !important; animation: ai-pulse 1.5s infinite; }
        @keyframes ai-pulse { 0% { transform: scale(1) rotate(var(--rot, 0deg)); } 50% { transform: scale(1.05) rotate(var(--rot, 0deg)); } 100% { transform: scale(1) rotate(var(--rot, 0deg)); } }
        .c-box.glow-ai { --rot: 45deg; }

        /* Number Pad Styles */
        .numpad-container { display: grid; grid-template-columns: repeat(5, 1fr); gap: 4px; width: 100%; }
        .num-btn { background: #0a192f; border: 1px solid #1e3a8a; height: 45px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 18px; font-weight: 900; color: #00f2ff; transition: 0.1s; cursor: pointer; }
        .num-btn:active { background: #1e3a8a; transform: scale(0.9); }
        .num-btn.undo { border-color: #ff4136; color: #ff4136; }

        .card-container { margin-top: 380px; padding: 10px; height: calc(100vh - 460px); overflow-x: auto; display: flex; gap: 12px; }
        .roll-card { min-width: 85vw; background: #0a192f; border: 2px solid #1e40af; border-radius: 12px; overflow-y: auto; flex-shrink: 0; }
        
        .t-row { display: grid; grid-template-columns: 35px 1fr 1fr 1fr 50px; border-bottom: 1px solid rgba(30, 64, 175, 0.4); height: 40px; align-items: center; text-align: center; }
        .t-head { background: #1e3a8a; font-weight: 900; color: #fbbf24; font-size: 11px; position: sticky; top: 0; }
        .digit-highlight { background: #fbbf24 !important; color: #000 !important; font-size: 20px !important; font-weight: 900 !important; }
        .latest-digit { animation: pulse-border 1s infinite; border: 2px solid #ff4136 !important; }
        @keyframes pulse-border { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }

        #digit-input { height: 50px; background: #000; border-radius: 6px; text-align: center; font-size: 32px; font-weight: 900; color: #00f2ff; border: 2px solid #1e40af; width: 100%; outline: none; }
        .footer { position: fixed; bottom: 0; left: 0; right: 0; display: flex; gap: 10px; padding: 10px; background: #010814; }
        .hidden { display: none !important; }
        #toast { visibility: hidden; min-width: 200px; background-color: #00f2ff; color: #000; text-align: center; border-radius: 50px; padding: 12px; position: fixed; z-index: 1100; left: 50%; bottom: 80px; transform: translateX(-50%); font-weight: 900; }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2s; }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-card">
            <h2 class="text-[#00f2ff] font-black text-2xl mb-2 italic uppercase">OMNI LOGIC PRO</h2>
            <input type="tel" id="access-input" placeholder="ENTER ID">
            <button onclick="verifyAccess()" class="verify-btn">ACTIVATE</button>
        </div>
    </div>

    <div id="toast">SYSTEM CONNECTED!</div>

    <div class="fixed-header">
        <div class="flex justify-between items-center mb-2 px-1">
            <span class="brand-title">Omni Logic Pro</span>
            <div id="user-badge" class="text-[10px] font-black">ID: OFFLINE</div>
        </div>

        <div class="grid grid-cols-3 gap-2 text-center">
            <div><div class="p-box a-box" id="box-a">?</div><div class="text-[9px] mt-1 text-slate-400" id="a-rate">A: 0%</div></div>
            <div><div class="p-box b-box" id="box-b">?</div><div class="text-[9px] mt-1 text-slate-400" id="b-rate">B: 0%</div></div>
            <div><div class="p-box c-box" id="box-c"><span>?</span></div><div class="text-[9px] mt-[12px] text-slate-400" id="c-rate">C: 0%</div></div>
        </div>

        <div class="flex gap-2 mt-4">
            <div class="w-[35%] flex flex-col gap-2">
                <input type="text" id="digit-input" readonly placeholder="?">
                <div id="total-val" class="text-[10px] text-yellow-500 font-bold text-center border border-yellow-500/30 p-1">TOTAL: 0</div>
            </div>
            <div class="flex-1">
                <div class="numpad-container">
                    <div class="num-btn" onclick="submitDigit(1)">1</div>
                    <div class="num-btn" onclick="submitDigit(2)">2</div>
                    <div class="num-btn" onclick="submitDigit(3)">3</div>
                    <div class="num-btn" onclick="submitDigit(4)">4</div>
                    <div class="num-btn" onclick="submitDigit(5)">5</div>
                    <div class="num-btn" onclick="submitDigit(6)">6</div>
                    <div class="num-btn" onclick="submitDigit(7)">7</div>
                    <div class="num-btn" onclick="submitDigit(8)">8</div>
                    <div class="num-btn" onclick="submitDigit(9)">9</div>
                    <div class="num-btn undo" onclick="undoLast()">‚å´</div>
                    <div class="num-btn col-span-5 h-[35px] mt-1" onclick="submitDigit(0)">0</div>
                </div>
            </div>
        </div>
        <div id="ai-notif" class="mt-3 bg-slate-800 border border-cyan-500 rounded p-1 text-center text-[10px] font-bold text-yellow-400 italic">SYSTEM READY</div>
    </div>

    <div class="card-container no-scrollbar" id="hist-cont"></div>

    <div class="footer">
        <button onclick="copyLogs()" class="flex-1 p-3 bg-slate-800 rounded-lg text-[12px] font-black border border-slate-600">COPY RECORD</button>
        <button onclick="location.reload()" class="flex-1 p-3 bg-red-900/30 rounded-lg text-[12px] font-black border border-red-700 text-red-500 uppercase">RESET ALL</button>
    </div>

    <script>
        const SB_URL = "https://folxuczagcspjnypyopw.supabase.co";
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZvbHh1Y3phZ2NzcGpueXB5b3B3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYzMjQ4MTAsImV4cCI6MjA4MTkwMDgxMH0.gOwmroH4rGr1iGATXK1NoSfg7gNs87hXJ8E3w13s5xo";
        const _supabase = supabase.createClient(SB_URL, SB_KEY);

        let hist = [], roll = 1, stage = 1, isVIP = false;
        let aN="?", bN="?", cN="?", aR=0, bR=0, cR=0;

        async function verifyAccess() {
            const input = document.getElementById('access-input').value.trim();
            if(!input) return;
            try {
                let { data: user } = await _supabase.from('user_access').select('*').eq('telegram_id', input).maybeSingle();
                if (user) {
                    isVIP = true;
                    document.getElementById('login-overlay').classList.add('hidden');
                    document.getElementById('user-badge').innerText = "VIP: " + input;
                    updateAI();
                } else { alert("ACCESS DENIED"); }
            } catch (e) { alert("Login Error"); }
        }

        function submitDigit(v) {
            document.getElementById('digit-input').value = v;
            const g = v >= 5 ? 'B' : 'S';
            
            // Current predictions
            const curA = aN, curB = isVIP ? bN : "üîí", curC = isVIP ? cN : "üîí";

            hist.push({ 
                v, g, r: roll, s: stage, 
                a: curA, aO: curA !== "?" && curA === g,
                b: curB, bO: curB !== "?" && curB !== "üîí" && curB === g,
                c: curC, cO: curC !== "?" && curC !== "üîí" && curC === g
            });

            if (stage === 10) { roll++; stage = 1; } else { stage++; }
            updateAI(); renderHistory();
            setTimeout(() => { document.getElementById('digit-input').value = ""; }, 300);
        }

        function undoLast() {
            if (hist.length === 0) return;
            if (!confirm("·Äî·Ä±·Ä¨·ÄÄ·Ä∫·ÄÜ·ÄØ·Ä∂·Ä∏·ÄÇ·Äè·Äî·Ä∫·Ä∏·ÄÄ·Ä≠·ÄØ ·Äï·Äº·Äî·Ä∫·Äñ·Äª·ÄÄ·Ä∫·Äô·Äú·Ä¨·Ä∏?")) return;
            
            hist.pop();
            if (stage === 1) { roll--; stage = 10; } else { stage--; }
            updateAI(); renderHistory();
            showToast("DELETED");
        }

        function updateAI() {
            const nums = hist.map(h => h.v);
            
            // Logic A (3-step)
            aN = nums.length >= 3 ? ((nums.slice(-3).reduce((a,b)=>a+b,0)) % 2 === 0 ? 'S' : 'B') : "?";
            
            if (isVIP) {
                // Logic B (7-step)
                bN = nums.length >= 7 ? ((nums.slice(-7).reduce((a,b)=>a+b,0)) % 10 % 2 === 0 ? 'S' : 'B') : "?";
                // Logic C (10-step)
                if (nums.length >= 10) {
                    const avg5 = nums.slice(-5).reduce((a,b)=>a+b,0)/5;
                    const avgPrev5 = nums.slice(-10, -5).reduce((a,b)=>a+b,0)/5;
                    cN = avg5 >= avgPrev5 ? "B" : "S";
                } else { cN = "?"; }
            }

            // Update UI Boxes
            document.getElementById('box-a').innerHTML = aN === "?" ? `<span style="color:#00f2ff">?</span>` : aN;
            document.getElementById('box-b').innerHTML = bN === "?" ? `<span style="color:#00f2ff">?</span>` : bN;
            document.getElementById('box-c').innerHTML = cN === "?" ? `<span>?</span>` : `<span>${cN}</span>`;

            // Rate Calculation & High Conf Glow
            let highConf = false;
            ['a','b','c'].forEach(k => {
                const hits = hist.filter(h => h[k] !== "?" && h[k] !== "üîí");
                const rate = hits.length ? Math.round(hits.filter(h => h[k+'O']).length / hits.length * 100) : 0;
                document.getElementById(k+'-rate').innerText = `${k.toUpperCase()}: ${rate}%`;
                if (rate >= 68 && (k === 'a' ? aN : k === 'b' ? bN : cN) !== "?") {
                    document.getElementById('box-'+k).classList.add('glow-ai');
                    highConf = true;
                } else {
                    document.getElementById('box-'+k).classList.remove('glow-ai');
                }
            });

            const status = document.getElementById('ai-notif');
            status.innerText = highConf ? "AI ·Ä°·Ä¨·Ä∏·ÄÄ·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äû·Ä±·Ä¨ Logic ·Äê·ÄΩ·Ä±·Ä∑·Äõ·Äæ·Ä≠·Äû·Ää·Ä∫" : "AI ·Äô·Äæ Pattern ·Äô·Äª·Ä¨·Ä∏·Ä°·Ä¨·Ä∏ ·Äú·Ä±·Ä∑·Äú·Ä¨·Äî·Ä±·Äû·Ää·Ä∫...";
        }

        function renderHistory() {
            const cont = document.getElementById('hist-cont');
            const grps = hist.reduce((acc, cur) => { if (!acc[cur.r]) acc[cur.r] = []; acc[cur.r].push(cur); return acc; }, {});
            const maxRoll = Math.max(roll, ...Object.keys(grps).map(Number));
            let html = "";

            for(let r=1; r<=maxRoll; r++) {
                html += `<div class="roll-card"><div class="t-row t-head"><div class="t-col">R-${r}</div><div class="t-col">A</div><div class="t-col">B</div><div class="t-col">C</div><div class="t-col">DIGIT</div></div>`;
                for(let s=1; s<=10; s++) {
                    const d = (grps[r] || []).find(i => i.s === s);
                    const isLatest = d && d === hist[hist.length-1];
                    const renderVal = (val, ok) => {
                        if(!d) return '';
                        if(val === "?" || val === "üîí") return val;
                        return `<span class="font-black">${val}</span> ${ok?'‚úÖ':'‚ùå'}`;
                    };

                    html += `<div class="t-row">
                        <div class="text-[10px] text-slate-500">${s}</div>
                        <div class="${d?.aO?'text-green-400':'text-red-500'}">${renderVal(d?.a, d?.aO)}</div>
                        <div class="${d?.bO?'text-green-400':'text-red-500'}">${renderVal(d?.b, d?.bO)}</div>
                        <div class="${d?.cO?'text-green-400':'text-red-500'}">${renderVal(d?.c, d?.cO)}</div>
                        <div class="digit-highlight ${isLatest?'latest-digit':''}" onclick="${isLatest?'undoLast()':''}">
                            ${d ? d.v : ''}
                        </div>
                    </div>`;
                }
                html += `</div>`;
            }
            cont.innerHTML = html;
            cont.scrollLeft = cont.scrollWidth;
        }

        function copyLogs() {
            let t = hist.map(h => `R${h.r}.S${h.s}: ${h.v}`).join('\n');
            navigator.clipboard.writeText(t).then(() => showToast("COPIED!"));
        }

        function showToast(m) { const t=document.getElementById("toast"); t.innerText=m; t.className="show"; setTimeout(()=>t.className="",2000); }
        window.onload = () => { renderHistory(); };
    </script>
</body>
</html>
