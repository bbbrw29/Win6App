<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Omni Logic Elite - Unfrozen</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        
        /* ·Äê·ÄÖ·Ä∫·Äô·Äª·ÄÄ·Ä∫·Äî·Äæ·Ä¨·Äú·ÄØ·Ä∂·Ä∏·ÄÄ·Ä≠·ÄØ Scroll ·Äú·ÄØ·Äï·Ä∫·ÄÅ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Ä±·Ä∏·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏ */
        html, body { 
            background-color: #010816; 
            color: white; 
            height: 100%;
            overflow-y: auto; /* Screen ·ÄÄ·Ä≠·ÄØ ·ÄÜ·ÄΩ·Ä≤·Äê·ÄÑ·Ä∫·ÄÜ·ÄΩ·Ä≤·ÄÅ·Äª·Äú·ÄØ·Äï·Ä∫·Äú·Ä≠·ÄØ·Ä∑·Äõ·Ä°·Ä±·Ä¨·ÄÑ·Ä∫ ·Äï·Äº·ÄÑ·Ä∫·Äú·Ä≠·ÄØ·ÄÄ·Ä∫·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏ */
            -webkit-overflow-scrolling: touch;
            font-family: 'Inter', sans-serif;
        }

        .box-p { border: 4px solid #ff4136; color: #ff4136; border-radius: 50%; width: 55px; height: 55px; font-size: 24px; display: flex; align-items: center; justify-content: center; margin: 0 auto; background: white; font-weight: 900; }
        .box-e { border: 4px solid #b10dc9; color: #b10dc9; border-radius: 12px; width: 55px; height: 55px; font-size: 24px; display: flex; align-items: center; justify-content: center; margin: 0 auto; background: white; font-weight: 900; position: relative; }
        .box-s { border: 4px solid #2ecc40; color: #2ecc40; border-radius: 8px; width: 50px; height: 50px; font-size: 24px; display: flex; align-items: center; justify-content: center; margin: 0 auto; transform: rotate(45deg); background: white; font-weight: 900; position: relative; }
        .box-s span { transform: rotate(-45deg); display: block; }
        
        /* PIH Section - Fixed Height Scroll */
        #intel-log-container { 
            height: 250px; /* PIH ·Ä°·Äê·ÄΩ·ÄÑ·Ä∫·Ä∏·Äë·Ä≤·ÄÄ·Ä≠·ÄØ ·Äû·ÄÆ·Ä∏·Äû·Äî·Ä∑·Ä∫ scroll ·ÄÜ·ÄΩ·Ä≤·Äõ·Äî·Ä∫ */
            overflow-y: auto; 
            padding-right: 5px;
        }

        .log-box { padding: 12px; margin-bottom: 8px; border-radius: 12px; border-left: 6px solid rgba(0,0,0,0.3); color: white; }
        .bg-big { background: #ff4136; } .bg-small { background: #2ecc40; } .bg-jump { background: #b10dc9; } .bg-double { background: #ffdc00; color: black; }
        
        .g-num { background: #ffdc00; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; border-radius: 50%; border: 2px solid #000; color: black; font-weight: 900; font-size: 14px; }
        .mini-shape { width: 22px; height: 22px; display: inline-flex; align-items: center; justify-content: center; background: white; font-weight: 900; font-size: 10px; border-width: 2px; }
        
        #toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #2ecc40; color: white; padding: 10px 20px; border-radius: 12px; font-weight: bold; display: none; z-index: 10000; }
    </style>
</head>
<body class="p-2 pb-20"> <div id="toast">COPIED!</div>

    <div id="app-main" class="max-w-md mx-auto space-y-4">
        <div class="text-center pt-2">
            <h1 class="text-xl font-black italic text-cyan-500 tracking-tighter uppercase">Omni Logic Elite</h1>
            <div id="plan-status" class="text-[9px] text-cyan-400 font-bold uppercase tracking-widest mt-1">Premium Access Active</div>
        </div>

        <div id="streak-warning" class="px-2" style="display: none;">
            <div id="warning-box" class="p-3 rounded-xl text-center border-l-4 shadow-2xl">
                <p id="warning-text" class="font-bold text-[12px] uppercase text-white"></p>
            </div>
        </div>

        <div class="bg-[#001d3d] p-3 grid grid-cols-3 gap-1 text-center rounded-[25px] border-b-4 border-cyan-500">
            <div><p class="text-[8px] text-gray-500 mb-1 font-black">P-LOGIC</p><div class="box-p"><span id="pred-p">-</span></div></div>
            <div><p class="text-[8px] text-gray-500 mb-1 font-black">E-LOGIC</p><div class="box-e"><span id="pred-e">-</span></div></div>
            <div><p class="text-[8px] text-gray-500 mb-1 font-black">S-LOGIC</p><div class="box-s"><span id="pred-s"></span></div></div>
        </div>

        <div class="bg-[#001d3d] p-5 rounded-[2.5rem] flex items-center justify-between border border-white/5 gap-3 shadow-lg">
            <div class="text-6xl font-black text-cyan-400 flex-1 text-center" id="highlight-g">-</div>
            <div class="flex flex-col gap-2 w-32">
                <input type="number" id="digit-input" class="w-full rounded-xl text-center text-4xl font-black p-2 border-4 border-cyan-500 text-black outline-none bg-white" placeholder="0" autofocus>
                <button class="w-full py-3 bg-cyan-500 text-white font-black rounded-xl active:bg-cyan-700 active:scale-95 transition-all" onclick="handleManualSubmit()">ENTER</button>
            </div>
        </div>

        <button onclick="copyAnalysis()" class="w-full py-3 bg-white/5 border border-white/10 rounded-2xl text-cyan-400 text-xs font-black uppercase tracking-widest">üìã Copy History Record</button>

        <div id="history-container" class="flex overflow-x-auto gap-3 py-1 scroll-smooth"></div>

        <div class="px-2">
            <div class="flex justify-between items-center mb-2">
                <h3 class="text-yellow-500 text-[10px] font-black uppercase tracking-wider">Pattern Intelligence History (PIH)</h3>
                <span id="pih-count" class="text-[9px] text-gray-500 font-bold">Patterns: 0</span>
            </div>
            <div id="intel-wrapper" class="bg-white/5 rounded-[2rem] p-4 border border-white/5">
                <div id="intel-log-container">
                    <p id="no-intel" class="text-center text-gray-700 text-[10px] mt-20 italic">Waiting for patterns...</p>
                </div>
            </div>
        </div>

        <div class="text-center pt-4 pb-10">
            <button onclick="fullReset()" class="text-[9px] text-red-900 font-bold uppercase tracking-widest opacity-40 hover:opacity-100">Reset Data History</button>
        </div>
    </div>

    <script>
        let history = []; let intelLogs = [];
        let roll = 1, stage = 1;
        let pNext = "-", eNext = "-", sNext = "-";
        let lastDetectedPattern = null;

        // Enter Key Listener
        document.getElementById('digit-input').addEventListener('keypress', (e) => { 
            if (e.key === 'Enter') handleManualSubmit(); 
        });

        function handleManualSubmit() {
            const el = document.getElementById('digit-input');
            let valStr = el.value.trim();
            if (valStr === "") return;

            let num = valStr.length > 1 ? valStr.split('').map(Number).reduce((a,b)=>a+b, 0) : parseInt(valStr);
            const grp = (num % 10) >= 5 ? 'B' : 'S';

            detectPattern(grp);

            history.push({ val: num, grp, roll, stage, p: pNext, pOk: (pNext===grp), e: eNext, eOk: (eNext===grp), s: sNext, sOk: (sNext===grp) });
            if(stage === 10) { roll++; stage = 1; } else { stage++; }
            
            updatePredictions(); renderTable(); save();
            el.value = ""; el.focus();
            document.getElementById('highlight-g').innerText = num;
        }

        function detectPattern(nextGrp) {
            const hStr = history.map(h => h.grp).join('') + nextGrp;
            let label = ""; let css = "";

            if (hStr.match(/(BBSSBBSS|SSBBSSBB)$/)) {
                label = "·Ä°·ÄÄ·Äº·ÄÆ·Ä∏ ·ÅÇ ·Äú·ÄØ·Ä∂·Ä∏·Åä ·Ä°·Äû·Ä±·Ä∏ ·ÅÇ ·Äú·ÄØ·Ä∂·Ä∏·ÄÖ·ÄÆ ·ÄÄ·Äª·Äî·Ä±·Äû·Ää·Ä∫"; css = "bg-double border-yellow-500";
            } else if (hStr.match(/(BSBSBS|SBSBSB)$/)) {
                label = "·Ä°·ÄÄ·Äº·ÄÆ·Ä∏/·Ä°·Äû·Ä±·Ä∏ ·Äê·ÄÖ·Ä∫·ÄÅ·ÄØ·ÄÄ·Äª·Ä±·Ä¨·Ä∫·ÄÖ·ÄÆ ·ÄÄ·Äª·Äî·Ä±·Äû·Ää·Ä∫"; css = "bg-jump border-purple-500";
            } else {
                const streak = hStr.match(/(B{4,}|S{4,})$/);
                if (streak) {
                    const count = streak[0].length;
                    label = `${streak[0][0]==='B'?'·Ä°·ÄÄ·Äº·ÄÆ·Ä∏ (BIG)':'·Ä°·Äû·Ä±·Ä∏ (SMALL)'} ·Äê·Ä±·Ä¨·ÄÄ·Ä∫·Äú·Äª·Äæ·Ä±·Ä¨·ÄÄ·Ä∫·ÄÄ·Äª·Äî·Ä±·Äû·Ää·Ä∫ - ${count} ·ÄÄ·Äº·Ä≠·Äô·Ä∫`;
                    css = streak[0][0]==='B' ? "bg-big border-red-500" : "bg-small border-green-500";
                }
            }

            const warnBox = document.getElementById('streak-warning');
            const warnText = document.getElementById('warning-text');
            const warnWrap = document.getElementById('warning-box');

            if (lastDetectedPattern && lastDetectedPattern.label !== label) {
                intelLogs.unshift({ 
                    id: intelLogs.length + 1,
                    label: lastDetectedPattern.label, 
                    css: lastDetectedPattern.css, 
                    time: `R${roll}S${stage-1}` 
                });
                renderIntel();
                lastDetectedPattern = null;
            }

            if (label) {
                warnBox.style.display = 'block';
                warnText.innerText = label;
                warnWrap.className = `p-3 rounded-xl text-center border-l-4 ${css}`;
                lastDetectedPattern = { label, css };
            } else {
                warnBox.style.display = 'none';
            }
        }

        function updatePredictions() {
            if (!history.length) return;
            const last = history[history.length-1].val;
            pNext = (last % 2 === 0) ? 'S' : 'B';
            eNext = history.length >= 3 ? (history.slice(-3).reduce((a,b)=>a+b.val,0) % 2 === 0 ? 'S' : 'B') : "-";
            if (history.length >= 5) {
                let sum = history.slice(-5).reduce((a,b)=>a+b.val,0);
                while(sum >= 10) sum = sum.toString().split('').map(Number).reduce((a,b)=>a+b,0);
                sNext = (sum % 2 !== 0) ? 'B' : 'S';
            }
            document.getElementById('pred-p').innerText = pNext;
            document.getElementById('pred-e').innerText = eNext;
            document.getElementById('pred-s').innerText = sNext || "-";
        }

        function renderIntel() {
            const container = document.getElementById('intel-log-container');
            document.getElementById('no-intel').style.display = 'none';
            document.getElementById('pih-count').innerText = `Patterns: ${intelLogs.length}`;
            
            container.innerHTML = intelLogs.map(l => `
                <div class="log-box ${l.css} shadow-lg">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-2">
                            <span class="bg-black/20 w-6 h-6 flex items-center justify-center rounded-full text-[9px] font-bold">#${l.id}</span>
                            <span class="text-[11px] font-black">${l.label}</span>
                        </div>
                        <span class="text-[8px] opacity-70 font-mono">${l.time}</span>
                    </div>
                </div>
            `).join('');
        }

        function renderTable() {
            const container = document.getElementById('history-container');
            const rolls = history.reduce((acc, cur) => { if(!acc[cur.roll]) acc[cur.roll] = []; acc[cur.roll].push(cur); return acc; }, {});
            container.innerHTML = Object.keys(rolls).map(r => `
                <div class="flex-shrink-0 w-64 bg-white/5 p-4 rounded-3xl border border-white/5">
                    <div class="text-[10px] text-center font-black text-cyan-500 mb-2 border-b border-white/10 pb-1 uppercase">Roll ${r}</div>
                    ${rolls[r].map(i => `
                        <div class="flex items-center justify-between py-1.5 border-b border-white/5 last:border-0">
                            <span class="text-[9px] text-gray-500 font-bold">${i.stage}</span>
                            <div class="mini-shape border-red-500 text-red-500 rounded-full">${i.p}</div>
                            <div class="mini-shape border-purple-500 text-purple-500 rounded-md">${i.e}</div>
                            <div class="mini-shape border-green-500 text-green-500 rotate-45"><span class="-rotate-45">${i.s}</span></div>
                            <div class="g-num">${i.val}</div>
                        </div>
                    `).join('')}
                </div>
            `).join('');
            container.scrollLeft = container.scrollWidth;
        }

        function copyAnalysis() {
            let log = "OMNI RECORD DATA\n";
            history.forEach(h => log += `${h.val} | P:${h.p}(${h.pOk?'ok':'x'}) E:${h.e}(${h.eOk?'ok':'x'}) S:${h.s}(${h.sOk?'ok':'x'})\n`);
            navigator.clipboard.writeText(log).then(() => {
                const t = document.getElementById('toast'); t.style.display='block';
                setTimeout(()=>t.style.display='none', 2000);
            });
        }

        function save() { localStorage.setItem('OMNI_V7_STABLE', JSON.stringify({ history, roll, stage, intelLogs })); }
        function load() {
            const d = JSON.parse(localStorage.getItem('OMNI_V7_STABLE'));
            if(d) { history=d.history; roll=d.roll; stage=d.stage; intelLogs=d.intelLogs || []; renderTable(); renderIntel(); updatePredictions(); }
        }
        function fullReset() { if(confirm("Clear All Logs?")) { localStorage.clear(); location.reload(); } }
        load();
    </script>
</body>
</html>
