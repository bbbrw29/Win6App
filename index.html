<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Omni Logic V46 - Fixed Marker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pyidaungsu:wght@400;700&display=swap');
        body { font-family: 'Pyidaungsu', sans-serif; background-color: #010816; color: white; overflow: hidden; touch-action: manipulation; }
        
        /* Fixed Header (V45 Locked) */
        .fixed-header { position: fixed; top: 0; left: 0; right: 0; z-index: 100; background: #010816; padding: 8px; border-bottom: 2px solid #00cfd5; }
        .box-p, .box-e, .box-s { width: 45px; height: 45px; font-size: 20px; display: flex; align-items: center; justify-content: center; background: white; font-weight: 900; margin: 0 auto; }
        .box-p { border: 4px solid #ff4136; color: #ff4136; border-radius: 50%; }
        .box-e { border: 4px solid #b10dc9; color: #b10dc9; border-radius: 10px; }
        .box-s { border: 4px solid #2ecc40; color: #2ecc40; border-radius: 6px; transform: rotate(45deg); }
        .box-s span { transform: rotate(-45deg); display: block; }

        .input-bar { background: #001d3d; padding: 8px; border-radius: 1rem; display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 5px; border: 1px solid rgba(0,207,213,0.3); }
        #digit-input { width: 60px; height: 45px; border-radius: 8px; text-align: center; font-size: 28px; font-weight: 900; border: 3px solid #00cfd5; color: black; outline: none; }
        .btn-enter { background: #00cfd5; color: black; font-weight: 900; width: 80px; height: 45px; border-radius: 8px; font-size: 14px; }

        .warn-bar { margin-top: 5px; padding: 4px; border-radius: 6px; text-align: center; min-height: 30px; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 900; }
        .warn-active { background: rgba(255, 65, 54, 0.2); border: 1px solid #ff4136; color: #ff4136; }
        .warn-stable { color: #444; font-style: italic; }

        /* Main Scroll & Cards */
        .main-scroll { margin-top: 215px; height: calc(100vh - 215px); overflow-y: auto; padding: 10px; }
        .roll-card { flex-shrink: 0; width: 290px; background: #001d3d; border-radius: 15px; padding: 10px; border: 1px solid #00cfd5; margin-right: 10px; height: fit-content; }
        .row-item { display: flex; align-items: center; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid rgba(255,255,255,0.05); position: relative; }
        .pred-text { font-size: 22px; font-weight: 900; } 
        .symbol-text { font-size: 22px; }
        .g-num { background: #ffdc00; width: 34px; height: 34px; display: flex; align-items: center; justify-content: center; border-radius: 50%; color: black; font-weight: 900; font-size: 18px; border: 2px solid #000; }

        /* Marker Styles */
        .stg-num { cursor: pointer; background: #1a3a5a; color: #00cfd5; width: 25px; height: 25px; display: flex; align-items: center; justify-content: center; border-radius: 4px; font-size: 11px; font-weight: bold; border: 1px solid transparent; }
        .stg-active { background: #ffdc00 !important; color: black !important; border: 1px solid white; box-shadow: 0 0 8px #ffdc00; }
        .row-range { background: rgba(0, 207, 213, 0.15); }

        /* Floating Box */
        #floating-box { position: fixed; right: 15px; bottom: 85px; width: 150px; background: rgba(0, 29, 61, 0.98); border: 2px solid #ffdc00; border-radius: 12px; padding: 12px; z-index: 1000; display: none; box-shadow: 0 0 20px rgba(0,0,0,0.8); }
        .float-header { font-size: 11px; font-weight: 900; color: #ffdc00; margin-bottom: 8px; border-bottom: 1px solid #444; padding-bottom: 4px; display: flex; justify-content: space-between; }
        .float-symbols { font-size: 20px; line-height: 1.4; word-wrap: break-word; text-align: center; }

        /* PHI & Buttons */
        .phi-container { margin-top: 15px; background: rgba(255,255,255,0.03); border-radius: 12px; padding: 10px; border: 1px solid rgba(255,255,255,0.1); }
        .phi-scroll-box { height: 160px; overflow-y: auto; margin-top: 10px; }
        .phi-item { padding: 10px; border-radius: 8px; margin-bottom: 6px; font-weight: 900; font-size: 12px; display: flex; justify-content: space-between; }
        .bg-big { background: #ff4136; color: white; }
        .bg-small { background: #2ecc40; color: white; }
        .bg-alt { background: #b10dc9; color: white; }
        .btn-big { flex: 1; padding: 12px; font-weight: 900; font-size: 14px; border-radius: 10px; text-align: center; }

        #toast { visibility: hidden; min-width: 120px; background-color: #00cfd5; color: black; text-align: center; border-radius: 50px; padding: 10px; position: fixed; z-index: 2000; bottom: 30px; left: 50%; transform: translateX(-50%); font-weight: 900; }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 1.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }
    </style>
</head>
<body>

    <div id="toast">Copied!</div>

    <div id="floating-box">
        <div class="float-header">
            <span id="float-title">PATTERN</span>
            <button onclick="clearMark()" style="color:#ff4136; font-size: 14px; font-weight: bold;">‚úï</button>
        </div>
        <div id="float-symbols" class="float-symbols"></div>
        <div id="float-info" style="font-size:9px; color:#aaa; margin-top:8px; text-align:center; font-weight: bold;"></div>
    </div>

    <div class="fixed-header">
        <div class="flex justify-between items-center mb-2 px-2">
            <span class="text-[10px] font-black text-cyan-500 italic">V46 STABLE MARKER</span>
            <span class="text-[9px] text-gray-600 uppercase">Logic Fixed</span>
        </div>
        <div class="grid grid-cols-3 gap-1">
            <div class="text-center"><div class="box-p" id="box-p">-</div></div>
            <div class="text-center"><div class="box-e" id="box-e">-</div></div>
            <div class="text-center"><div class="box-s" id="box-s">-</div></div>
        </div>
        <div class="input-bar">
            <input type="tel" id="digit-input" maxlength="1" placeholder="?">
            <button onclick="submitDigit()" class="btn-enter">ENTER</button>
        </div>
        <div id="warning-bar" class="warn-bar warn-stable">MARKET STABLE</div>
    </div>

    <div class="main-scroll">
        <div id="history-container" class="flex overflow-x-auto gap-2 pb-2"></div>
        <div class="phi-container">
            <div class="flex gap-3 mb-3">
                <button onclick="copyLogs()" class="btn-big bg-cyan-600">üìã COPY DATA</button>
                <button onclick="fullReset()" class="btn-big bg-red-600">üóëÔ∏è RESET ALL</button>
            </div>
            <div id="phi-list" class="phi-scroll-box"></div>
        </div>
        <div class="h-20"></div>
    </div>

    <script>
        let history = [], phiRecords = [], roll = 1, stage = 1;
        let pNext = "-", eNext = "-", sNext = "-", currentPattern = null;
        let markStartIdx = null, markEndIdx = null;

        function submitDigit() {
            const input = document.getElementById('digit-input');
            const val = parseInt(input.value);
            if (isNaN(val)) return;
            const grp = val >= 5 ? 'B' : 'S';
            
            const entry = { id: Date.now(), val, grp, roll, stage, p: pNext, pOk: pNext === grp, e: eNext, eOk: eNext === grp, s: sNext, sOk: sNext === grp };
            history.push(entry);
            
            checkPatterns(entry);
            if (stage === 10) { roll++; stage = 1; } else { stage++; }
            
            updatePredictions(val);
            renderUI();
            input.value = ""; input.focus();
            save();
        }

        function toggleMark(id) {
            const idx = history.findIndex(h => h.id === id);
            
            if (markStartIdx === null || (markStartIdx !== null && markEndIdx !== null)) {
                markStartIdx = idx;
                markEndIdx = null;
                showToast("·ÄÖ·Äô·Äæ·Äê·Ä∫ ·Äû·Äê·Ä∫·Äô·Äæ·Äê·Ä∫·Äï·Äº·ÄÆ·Ä∏");
            } else {
                markEndIdx = idx;
                const range = [markStartIdx, markEndIdx].sort((a,b) => a-b);
                markStartIdx = range[0];
                markEndIdx = range[1];
                
                const logic = prompt("Logic ·Äõ·ÄΩ·Ä±·Ä∏·Äï·Ä´ (P, E, ·Äû·Ä≠·ÄØ·Ä∑·Äô·Äü·ÄØ·Äê·Ä∫ S ·Äõ·Ä≠·ÄØ·ÄÄ·Ä∫·Äï·Ä´)");
                if (logic && ['P','E','S','p','e','s'].includes(logic)) {
                    showFloating(logic.toUpperCase());
                } else {
                    clearMark();
                }
            }
            renderUI();
        }

        function showFloating(type) {
            const sub = history.slice(markStartIdx, markEndIdx + 1);
            const syms = sub.map(h => {
                let ok = (type === 'P') ? h.pOk : (type === 'E' ? h.eOk : h.sOk);
                return ok ? '‚úÖ' : '‚ùå';
            }).join(' ');

            document.getElementById('floating-box').style.display = 'block';
            document.getElementById('float-title').innerText = `${type}-PATTERN`;
            document.getElementById('float-symbols').innerText = syms;
            document.getElementById('float-info').innerText = `R${sub[0].roll}.S${sub[0].stage} ‚ûî R${sub[sub.length-1].roll}.S${sub[sub.length-1].stage}`;
        }

        function clearMark() {
            markStartIdx = null; markEndIdx = null;
            document.getElementById('floating-box').style.display = 'none';
            renderUI();
        }

        function renderUI() {
            const container = document.getElementById('history-container');
            const groups = history.reduce((acc, cur) => { if (!acc[cur.roll]) acc[cur.roll] = []; acc[cur.roll].push(cur); return acc; }, {});
            
            container.innerHTML = Object.keys(groups).map(rNum => `
                <div class="roll-card">
                    <div class="text-[10px] font-black text-cyan-500 mb-2 border-b border-white/10 italic">ROLL ${rNum}</div>
                    ${groups[rNum].map(i => {
                        const currentIdx = history.findIndex(h => h.id === i.id);
                        let rowClass = "";
                        let stgClass = "";

                        if (currentIdx === markStartIdx || currentIdx === markEndIdx) stgClass = "stg-active";
                        if (markEndIdx !== null && currentIdx > markStartIdx && currentIdx < markEndIdx) rowClass = "row-range";

                        return `
                        <div class="row-item ${rowClass}">
                            <div onclick="toggleMark(${i.id})" class="stg-num ${stgClass}">${i.stage}</div>
                            <div class="flex gap-4">
                                <span class="${i.pOk?'text-green-500':'text-red-500'} pred-text">${i.p}<span class="symbol-text">${i.pOk?'‚úÖ':'‚ùå'}</span></span>
                                <span class="${i.eOk?'text-green-500':'text-red-500'} pred-text">${i.e}<span class="symbol-text">${i.eOk?'‚úÖ':'‚ùå'}</span></span>
                                <span class="${i.sOk?'text-green-500':'text-red-500'} pred-text">${i.s}<span class="symbol-text">${i.sOk?'‚úÖ':'‚ùå'}</span></span>
                            </div>
                            <div class="g-num">${i.val}</div>
                        </div>`;
                    }).join('')}
                </div>`).join('');
            container.scrollLeft = container.scrollWidth;
        }

        // V45 Standard Logics
        function updatePredictions(last) {
            pNext = (last % 2 === 0) ? 'S' : 'B';
            if (history.length >= 3) {
                const s3 = history.slice(-3).reduce((a, b) => a + b.val, 0);
                eNext = (s3 % 2 === 0) ? 'S' : 'B';
            }
            if (history.length >= 5) {
                let dSum = history.slice(-5).reduce((a, b) => a + b.val, 0);
                while (dSum >= 10) dSum = dSum.toString().split('').map(Number).reduce((a, b) => a + b, 0);
                sNext = (dSum % 2 !== 0) ? 'B' : 'S';
            }
            document.getElementById('box-p').innerText = pNext;
            document.getElementById('box-e').innerText = eNext;
            document.getElementById('box-s').innerText = sNext;
        }

        function checkPatterns(entry) {
            const seq = history.map(h => h.grp).join('');
            const sMatch = seq.match(/(B{6,}|S{6,})$/);
            const aMatch = seq.match(/((SB){3,}|(BS){3,})$/);
            let active = null;
            if (sMatch) active = { type: sMatch[0][0]==='B'?"·Ä°·ÄÄ·Äº·ÄÆ·Ä∏·Äô·Äª·Ä¨·Ä∏ ·ÄÜ·ÄÄ·Ä∫·Äê·Ä≠·ÄØ·ÄÄ·Ä∫·Äë·ÄΩ·ÄÄ·Ä∫·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏":"·Ä°·Äû·Ä±·Ä∏·Äô·Äª·Ä¨·Ä∏ ·ÄÜ·ÄÄ·Ä∫·Äê·Ä≠·ÄØ·ÄÄ·Ä∫·Äë·ÄΩ·ÄÄ·Ä∫·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏", count: sMatch[0].length, class: sMatch[0][0]==='B'?"bg-big":"bg-small" };
            else if (aMatch) active = { type: "·Ä°·ÄÄ·Äº·ÄÆ·Ä∏/·Ä°·Äû·Ä±·Ä∏ ·Äê·ÄÖ·Ä∫·Äú·Äæ·Ää·Ä∑·Ä∫·ÄÖ·ÄÆ·Äë·ÄΩ·ÄÄ·Ä∫·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏", count: aMatch[0].length, class: "bg-alt" };
            const bar = document.getElementById('warning-bar');
            if (active) { bar.className = "warn-bar warn-active"; bar.innerText = `‚ö†Ô∏è ${active.type} : ${active.count} ·ÄÄ·Äº·Ä≠·Äô·Ä∫`; }
            else { if (currentPattern) { phiRecords.unshift({ ...currentPattern, time: `R${entry.roll} S${entry.stage}` }); renderPHI(); }
            bar.className = "warn-bar warn-stable"; bar.innerText = "MARKET STABLE"; }
            currentPattern = active;
        }

        function renderPHI() {
            document.getElementById('phi-list').innerHTML = phiRecords.map((r, idx) => `
                <div class="phi-item ${r.class}">
                    <span>#${phiRecords.length - idx} | ${r.type} (${r.count})</span>
                    <span class="opacity-70 text-[10px]">${r.time}</span>
                </div>`).join('');
        }

        function copyLogs() {
            if (history.length === 0) return;
            let log = history.map(h => `R${h.roll}.S${h.stage} | P(${h.p}${h.pOk?'‚úÖ':'‚ùå'}) E(${h.e}${h.eOk?'‚úÖ':'‚ùå'}) S(${h.s}${h.sOk?'‚úÖ':'‚ùå'}) | G(${h.val})`).join('\n');
            navigator.clipboard.writeText(log).then(() => showToast("Copied!"));
        }

        function showToast(txt) {
            const t = document.getElementById("toast"); t.innerText = txt;
            t.className = "show"; setTimeout(() => t.className = "", 2000);
        }

        function fullReset() { if(confirm("Data ·Ä°·Ä¨·Ä∏·Äú·ÄØ·Ä∂·Ä∏·Äñ·Äª·ÄÄ·Ä∫·Äô·Äæ·Ä¨·Äú·Ä¨·Ä∏?")) { localStorage.clear(); location.reload(); } }
        function save() { localStorage.setItem('V46_FIXED', JSON.stringify({ history, phiRecords, roll, stage })); }
        
        window.onload = () => {
            const saved = JSON.parse(localStorage.getItem('V46_FIXED'));
            if (saved) {
                history = saved.history || []; phiRecords = saved.phiRecords || [];
                roll = saved.roll || 1; stage = saved.stage || 1;
                renderUI(); renderPHI();
                if (history.length) updatePredictions(history[history.length-1].val);
            }
        };
    </script>
</body>
</html>
