<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Omni Logic V46.4 - AI MASTER</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pyidaungsu:wght@400;700&display=swap');
        body { font-family: 'Pyidaungsu', sans-serif; background-color: #020c1b; color: white; overflow: hidden; touch-action: manipulation; }
        
        .fixed-header { position: fixed; top: 0; left: 0; right: 0; z-index: 100; background: #020c1b; padding: 15px 10px; border-bottom: 2px solid #00f2ff; box-shadow: 0 4px 20px rgba(0, 242, 255, 0.2); }
        
        /* Prediction Boxes */
        .box-container { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; text-align: center; }
        .box-title { font-size: 12px; font-weight: 900; color: #666; margin-bottom: 5px; text-transform: uppercase; }
        .predict-box { width: 55px; height: 55px; display: flex; align-items: center; justify-content: center; background: #fff; font-weight: 900; margin: 0 auto; font-size: 24px; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative; }
        
        .p-box { border: 4px solid #ff4136; color: #ff4136; border-radius: 50%; }
        .e-box { border: 4px solid #b10dc9; color: #b10dc9; border-radius: 12px; }
        .s-box { border: 4px solid #2ecc40; color: #2ecc40; border-radius: 8px; transform: rotate(45deg); }
        .s-box span { transform: rotate(-45deg); display: inline-block; }

        /* AI Smart Glows */
        .glow-cyan { box-shadow: 0 0 25px #00f2ff, inset 0 0 10px #00f2ff; border-color: #00f2ff !important; animation: pulse 1.5s infinite; }
        .glow-red { box-shadow: 0 0 25px #ff4136, inset 0 0 10px #ff4136; border-color: #ff4136 !important; background: #ffdada !important; animation: shake 0.5s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-2px); } 75% { transform: translateX(2px); } }

        /* PHI Intensity Bar */
        .phi-container { width: 100%; height: 6px; background: #111; border-radius: 10px; margin: 15px 0; overflow: hidden; }
        #phi-bar { width: 0%; height: 100%; background: linear-gradient(to right, #00f2ff, #ff00ff); transition: width 0.5s ease; }

        .win-rate { font-size: 11px; font-weight: 900; color: #00f2ff; margin-top: 8px; }
        .status-text { font-size: 10px; color: #888; text-align: center; margin-top: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }

        .main-scroll { margin-top: 260px; height: calc(100vh - 260px); overflow-y: auto; padding: 15px; }
        .roll-card { background: #0a192f; border-radius: 18px; padding: 15px; border: 1px solid #1e3a8a; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        #toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #00f2ff; color: #000; padding: 12px 30px; border-radius: 50px; font-weight: 900; display: none; z-index: 1000; }
    </style>
</head>
<body>

    <div id="toast">Copied Success!</div>

    <div class="fixed-header">
        <div class="box-container">
            <div>
                <div class="box-title">Trend P</div>
                <div class="predict-box p-box" id="box-p">-</div>
                <div class="win-rate" id="p-rate">RATE: 0%</div>
            </div>
            <div>
                <div class="box-title">Flow E</div>
                <div class="predict-box e-box" id="box-e">-</div>
                <div class="win-rate" id="e-rate">RATE: 0%</div>
            </div>
            <div>
                <div class="box-title" style="margin-left: 10px;">Weight S</div>
                <div class="predict-box s-box" id="box-s"><span>-</span></div>
                <div class="win-rate" id="s-rate" style="margin-top: 18px;">RATE: 0%</div>
            </div>
        </div>

        <div class="phi-container"><div id="phi-bar"></div></div>
        
        <div class="flex gap-2 items-center justify-center">
            <input type="tel" id="digit-input" class="w-24 h-14 rounded-xl text-center text-4xl font-black text-black border-4 border-cyan-500 shadow-lg" maxlength="1">
            <button onclick="submitDigit()" class="bg-cyan-500 hover:bg-cyan-400 text-black h-14 px-8 rounded-xl font-black transition-all active:scale-95">ENTER</button>
        </div>
        <div id="ai-status" class="status-text">Ready to Analyze Market...</div>
    </div>

    <div class="main-scroll">
        <div class="flex gap-3 mb-6">
            <button onclick="copyLogs()" class="flex-1 p-4 bg-slate-800 rounded-2xl font-black text-xs border border-slate-600">COPY LOGS</button>
            <button onclick="fullReset()" class="flex-1 p-4 bg-red-900 rounded-2xl font-black text-xs border border-red-700">FULL RESET</button>
        </div>
        <div id="history-container"></div>
    </div>

    <script>
        let history = [], roll = 1, stage = 1;
        let pNext = "-", eNext = "-", sNext = "-";
        let streakTracker = { p:0, e:0, s:0 }; // To track losing streaks for Emergency Red Glow

        function submitDigit() {
            const input = document.getElementById('digit-input');
            const val = parseInt(input.value);
            if (isNaN(val)) return;
            const grp = val >= 5 ? 'B' : 'S';

            const entry = {
                val, grp, roll, stage,
                p: pNext, pOk: pNext === "-" ? null : pNext === grp,
                e: eNext, eOk: eNext === "-" ? null : eNext === grp,
                s: sNext, sOk: sNext === "-" ? null : sNext === grp
            };

            // Emergency Streak Tracking
            if (entry.pOk === false) streakTracker.p++; else streakTracker.p = 0;
            if (entry.eOk === false) streakTracker.e++; else streakTracker.e = 0;
            if (entry.sOk === false) streakTracker.s++; else streakTracker.s = 0;

            history.push(entry);
            if (stage === 10) { roll++; stage = 1; } else { stage++; }
            
            updateAI(val);
            renderUI();
            input.value = ""; input.focus();
            localStorage.setItem('V46_4_MASTER', JSON.stringify({history, roll, stage, streakTracker}));
        }

        function updateAI(last) {
            // 1. Trend-Based Logic P (Follows recent trend)
            if (history.length >= 2) {
                const last2 = history.slice(-2);
                if (last2[0].grp === last2[1].grp) pNext = last2[1].grp; // Trend Follow
                else pNext = last2[1].grp === 'B' ? 'S' : 'B'; // Zigzag Follow
            } else { pNext = last >= 5 ? 'B' : 'S'; }

            // 2. Flow-Based Logic E (Stable 3-Sum)
            if (history.length >= 3) {
                const sum3 = history.slice(-3).reduce((a, b) => a + b.val, 0);
                eNext = (sum3 % 2 === 0) ? 'S' : 'B';
            }

            // 3. Adaptive Weight Logic S (Mean Strength)
            if (history.length >= 5) {
                const mean = history.slice(-5).reduce((a, b) => a + b.val, 0) / 5;
                sNext = mean >= 4.5 ? 'B' : 'S';
            }

            // Update UI Boxes
            document.getElementById('box-p').innerText = pNext;
            document.getElementById('box-e').innerText = eNext;
            document.getElementById('box-s').innerHTML = `<span>${sNext}</span>`;

            calculateWinRates();
            updatePHI();
        }

        function calculateWinRates() {
            const last15 = history.slice(-15);
            const getRate = (type) => {
                const valid = last15.filter(h => h[type] !== "-");
                if (valid.length === 0) return 0;
                return Math.round((valid.filter(h => h[type + 'Ok']).length / valid.length) * 100);
            };

            const rates = { p: getRate('p'), e: getRate('e'), s: getRate('s') };
            document.getElementById('p-rate').innerText = `RATE: ${rates.p}%`;
            document.getElementById('e-rate').innerText = `RATE: ${rates.e}%`;
            document.getElementById('s-rate').innerText = `RATE: ${rates.s}%`;

            // AI GLOW SYSTEM
            const boxes = { p: 'box-p', e: 'box-e', s: 'box-s' };
            Object.keys(boxes).forEach(key => {
                const el = document.getElementById(boxes[key]);
                el.classList.remove('glow-cyan', 'glow-red');
                
                if (streakTracker[key] >= 4) {
                    el.classList.add('glow-red'); // Emergency Stop
                } else if (rates[key] >= 80) {
                    el.classList.add('glow-cyan'); // AI Recommendation
                }
            });

            // AI Status Text
            const status = document.getElementById('ai-status');
            const maxRate = Math.max(rates.p, rates.e, rates.s);
            if (Object.values(streakTracker).some(v => v >= 4)) {
                status.innerText = "‚ö†Ô∏è High Risk Detected - Follow AI Glow";
                status.style.color = "#ff4136";
            } else if (maxRate >= 80) {
                status.innerText = "üî• AI Signal Strong - Follow Cyan Glow";
                status.style.color = "#00f2ff";
            } else {
                status.innerText = "Market Analysis in Progress...";
                status.style.color = "#888";
            }
        }

        function updatePHI() {
            if (history.length < 5) return;
            const last5 = history.slice(-5);
            const bCount = last5.filter(h => h.grp === 'B').length;
            const intensity = Math.abs(bCount - 2.5) * 40; 
            document.getElementById('phi-bar').style.width = intensity + "%";
        }

        function renderUI() {
            const container = document.getElementById('history-container');
            const groups = history.reduce((acc, cur) => { if (!acc[cur.roll]) acc[cur.roll] = []; acc[cur.roll].push(cur); return acc; }, {});
            
            container.innerHTML = Object.keys(groups).reverse().map(r => `
                <div class="roll-card">
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-xs font-black text-cyan-400">ROLL ${r}</span>
                        <span class="text-[9px] text-slate-500 uppercase">AI Protected</span>
                    </div>
                    ${groups[r].map(i => `
                        <div class="grid grid-cols-5 gap-1 py-2 border-b border-white/5 items-center text-center">
                            <div class="bg-slate-800 rounded text-[10px] py-1 font-bold text-cyan-300">${i.stage}</div>
                            <div class="text-[13px] font-black ${i.pOk?'text-green-400':'text-red-500'}">${i.p}${i.pOk?'‚úÖ':'‚ùå'}</div>
                            <div class="text-[13px] font-black ${i.eOk?'text-green-400':'text-red-500'}">${i.e}${i.eOk?'‚úÖ':'‚ùå'}</div>
                            <div class="text-[13px] font-black ${i.sOk?'text-green-400':'text-red-500'}">${i.s}${i.sOk?'‚úÖ':'‚ùå'}</div>
                            <div class="text-lg font-black text-yellow-400">${i.val}</div>
                        </div>
                    `).join('')}
                </div>
            `).join('');
        }

        function copyLogs() {
            let logText = history.map(h => `R${h.roll}.S${h.stage} | P:${h.p}${h.pOk?'‚úÖ':'‚ùå'} E:${h.e}${h.eOk?'‚úÖ':'‚ùå'} S:${h.s}${h.sOk?'‚úÖ':'‚ùå'} | G(${h.val})`).join('\n');
            navigator.clipboard.writeText(logText).then(() => {
                const t = document.getElementById('toast');
                t.style.display = 'block'; setTimeout(() => t.style.display = 'none', 2000);
            });
        }

        function fullReset() { if(confirm("Clear All Data & Reset AI?")) { localStorage.clear(); location.reload(); } }

        window.onload = () => {
            const saved = JSON.parse(localStorage.getItem('V46_4_MASTER'));
            if (saved) { 
                history = saved.history; roll = saved.roll; stage = saved.stage; 
                streakTracker = saved.streakTracker || {p:0, e:0, s:0};
                renderUI(); 
                if(history.length) { updateAI(history[history.length-1].val); } 
            }
        };
    </script>
</body>
</html>
