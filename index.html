<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Win6 Pro Premium</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pyidaungsu:wght@400;700&display=swap');
        body { font-family: 'Pyidaungsu', sans-serif; background-color: #001f3f; color: white; }
        .login-bg { background: radial-gradient(circle at center, #003366 0%, #001f3f 100%); }
        .g-display { font-size: 85px; font-weight: 900; color: #ffdc00; text-shadow: 4px 4px 0px #000; }
        .box-p { border: 5px solid #ff4136; border-radius: 50%; width: 75px; height: 75px; font-size: 38px; display: flex; align-items: center; justify-content: center; background: white; color: #ff4136; font-weight: 900; }
        .box-e { border: 5px solid #b10dc9; border-radius: 15px; width: 75px; height: 75px; font-size: 38px; display: flex; align-items: center; justify-content: center; background: white; color: #b10dc9; font-weight: 900; }
        .box-s { border: 5px solid #2ecc40; border-radius: 10px; width: 68px; height: 68px; font-size: 38px; display: flex; align-items: center; justify-content: center; transform: rotate(45deg); background: white; color: #2ecc40; font-weight: 900; }
        .box-s span { transform: rotate(-45deg); }
    </style>
</head>
<body>

    <div id="login-screen" class="fixed inset-0 z-[100] login-bg flex items-center justify-center p-6">
        <div class="w-full max-w-sm bg-[#003366] rounded-[2.5rem] p-8 border-t-8 border-yellow-400 shadow-2xl text-center">
            <h1 class="text-3xl font-black text-yellow-400 mb-6 italic">WIN6 PRO LOGIN</h1>
            <input type="text" id="activation-input" class="w-full bg-[#001f3f] border-2 border-white/20 rounded-2xl py-4 text-center text-2xl font-bold text-yellow-400 mb-4 outline-none focus:border-yellow-400" placeholder="Enter Code">
            <button onclick="checkSubscription()" id="login-btn" class="w-full bg-yellow-400 text-black font-black py-4 rounded-2xl text-xl shadow-lg active:scale-95 transition-all">ACTIVATE</button>
            <p id="status-msg" class="mt-4 text-red-500 font-bold hidden"></p>
        </div>
    </div>

    <div id="main-app" class="hidden p-4 max-w-2xl mx-auto space-y-6">
        <div class="bg-[#003366] p-6 grid grid-cols-3 gap-2 text-center rounded-[35px] shadow-2xl">
            <div><p class="text-[10px] mb-2 font-bold uppercase">Pred P</p><div class="box-p" id="pred-p">-</div></div>
            <div><p class="text-[10px] mb-2 font-bold uppercase">Pred E</p><div class="box-e" id="pred-e">-</div></div>
            <div><p class="text-[10px] mb-2 font-bold uppercase">Pred S</p><div class="box-s"><span id="pred-s">-</span></div></div>
        </div>

        <div class="bg-blue-900/60 p-6 rounded-[2rem] flex items-center justify-between border-2 border-white/10">
            <div id="highlight-g" class="g-display">-</div>
            <div class="w-40 space-y-3">
                <input type="number" id="digit-input" class="w-full rounded-2xl text-center text-5xl font-black p-4 border-4 border-yellow-400 text-black outline-none" placeholder="?" oninput="if(this.value.length>1)this.value=this.value.slice(-1)">
                <button onclick="submit()" class="w-full py-4 bg-yellow-400 text-black font-black rounded-xl text-xl">ENTER</button>
            </div>
        </div>

        <div id="history-container" class="flex overflow-x-auto gap-4 pb-4"></div>
        
        <button onclick="logout()" class="w-full py-4 bg-red-600 text-white font-black rounded-2xl shadow-xl uppercase">Logout & Reset</button>
    </div>

    <script>
        const SB_URL = "https://fbhmrpsvunllixcpikmh.supabase.co";
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZiaG1ycHN2dW5sbGl4Y3Bpa21oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4NjA3NzEsImV4cCI6MjA4MTQzNjc3MX0._ulaGqnNm8KK9abLlI2Pvjc_OU4PuPibwKd9PmpvDwk";
        const supabaseClient = supabase.createClient(SB_URL, SB_KEY);

        async function checkSubscription() {
            const codeInput = document.getElementById('activation-input').value.trim();
            const btn = document.getElementById('login-btn');
            const msg = document.getElementById('status-msg');
            
            if(!codeInput) return;
            btn.disabled = true; btn.innerText = "Checking...";

            try {
                const { data, error } = await supabaseClient
                    .from('subscription_codes')
                    .select('*')
                    .eq('code', codeInput)
                    .single();

                if (!data || error) {
                    msg.innerText = "Code မမှန်ပါ။";
                    msg.classList.remove('hidden');
                } else if (data.is_used === true) {
                    // အရင်ဝင်ထားတဲ့ဖုန်း ဖြစ်/မဖြစ် စစ် (ဒါမှ ဖုန်းတစ်လုံးပဲ သုံးရမှာ)
                    if (localStorage.getItem('win6_pro_code') === codeInput) {
                        enterApp();
                    } else {
                        msg.innerText = "ဤကုဒ်ကို အသုံးပြုပြီးသားဖြစ်ပါသည်။";
                        msg.classList.remove('hidden');
                    }
                } else {
                    // စတင်အသုံးပြုခြင်း (FALSE ကို TRUE ပြောင်းမည်)
                    const { updateError } = await supabaseClient
                        .from('subscription_codes')
                        .update({ 
                            is_used: true, 
                            used_at: new Date().toISOString() 
                        })
                        .eq('code', codeInput);

                    if (!updateError) {
                        localStorage.setItem('win6_pro_auth', 'true');
                        localStorage.setItem('win6_pro_code', codeInput);
                        enterApp();
                    }
                }
            } catch (e) {
                alert("ချိတ်ဆက်မှု အဆင်မပြေပါ။");
            } finally {
                btn.disabled = false; btn.innerText = "ACTIVATE";
            }
        }

        function enterApp() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            loadLocalData();
        }

        let history = [];
        function submit() {
            const val = document.getElementById('digit-input').value;
            if (val === "") return;
            const entry = { val: parseInt(val), grp: val >= 5 ? 'B' : 'S', time: new Date().toLocaleTimeString() };
            history.push(entry);
            renderUI();
            saveLocalData();
            document.getElementById('digit-input').value = "";
            document.getElementById('highlight-g').innerText = val;
        }

        function renderUI() {
            const container = document.getElementById('history-container');
            container.innerHTML = history.map(h => `
                <div class="flex-shrink-0 bg-white text-black p-4 rounded-2xl text-center min-w-[80px]">
                    <div class="text-xs font-bold text-gray-400">${h.time}</div>
                    <div class="text-3xl font-black">${h.val}</div>
                    <div class="text-sm font-bold ${h.grp === 'B' ? 'text-blue-600' : 'text-red-600'}">${h.grp}</div>
                </div>
            `).join('');
            container.scrollLeft = container.scrollWidth;
        }

        function saveLocalData() { localStorage.setItem('win6_logs', JSON.stringify(history)); }
        function loadLocalData() { 
            const saved = localStorage.getItem('win6_logs');
            if (saved) { history = JSON.parse(saved); renderUI(); }
        }
        function logout() { localStorage.clear(); location.reload(); }
        if (localStorage.getItem('win6_pro_auth') === 'true') enterApp();
    </script>
</body>
</html>
