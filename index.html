<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Omni Logic - V28</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        html, body { background-color: #010816; color: white; height: 100%; font-family: 'Inter', sans-serif; overflow: hidden; }
        
        /* Layout Layers */
        .fixed-top { position: fixed; top: 0; left: 0; right: 0; z-index: 50; background: #010816; padding: 8px; }
        .scrollable-content { margin-top: 260px; height: calc(100vh - 260px); overflow-y: auto; padding: 8px; }

        /* Logic Boxes */
        .box-p { border: 3px solid #ff4136; color: #ff4136; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; background: white; font-weight: 900; margin: 0 auto; }
        .box-e { border: 3px solid #b10dc9; color: #b10dc9; border-radius: 8px; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; background: white; font-weight: 900; margin: 0 auto; }
        .box-s { border: 3px solid #2ecc40; color: #2ecc40; border-radius: 6px; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; transform: rotate(45deg); background: white; font-weight: 900; margin: 0 auto; }
        .box-s span { transform: rotate(-45deg); }

        /* History Card */
        .roll-card { flex-shrink: 0; width: 290px; background: rgba(255,255,255,0.05); border-radius: 1.5rem; padding: 12px; border: 1px solid rgba(255,255,255,0.1); margin-right: 12px; }
        .status-ok { color: #2ecc40; font-weight: 900; font-size: 12px; }
        .status-no { color: #ff4136; font-weight: 900; font-size: 12px; }
        .g-num { background: #ffdc00; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; border-radius: 50%; color: black; font-weight: 900; font-size: 14px; }
        
        /* PIH Section */
        #intel-log-container { height: 150px; overflow-y: auto; background: rgba(255,255,255,0.03); border-radius: 1rem; padding: 10px; border: 1px solid rgba(255,255,255,0.05); }
        
        #toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #2ecc40; padding: 8px 16px; border-radius: 20px; display: none; z-index: 100; font-weight: bold; }
    </style>
</head>
<body>
    <div id="toast">COPIED!</div>

    <div class="fixed-top space-y-3">
        <div class="text-center">
            <h1 class="text-lg font-black text-cyan-500 italic">OMNI V28</h1>
            <div id="streak-warning" class="hidden animate-pulse">
                <div id="warning-box" class="py-1 px-4 rounded-full inline-block text-[10px] font-black uppercase text-white"></div>
            </div>
        </div>

        <div class="grid grid-cols-3 gap-2 bg-[#001d3d] p-3 rounded-2xl shadow-xl">
            <div class="text-center"><p class="text-[8px] text-gray-400 font-bold mb-1">P-LOGIC</p><div class="box-p" id="pred-p">-</div></div>
            <div class="text-center"><p class="text-[8px] text-gray-400 font-bold mb-1">E-LOGIC</p><div class="box-e" id="pred-e">-</div></div>
            <div class="text-center"><p class="text-[8px] text-gray-400 font-bold mb-1">S-LOGIC</p><div class="box-s" id="pred-s"><span>-</span></div></div>
        </div>

        <div class="bg-cyan-900/20 p-3 rounded-2xl flex items-center justify-between border border-cyan-500/30">
            <div class="text-5xl font-black text-cyan-400 flex-1 text-center" id="highlight-g">-</div>
            <div class="w-32">
                <input type="tel" id="digit-input" maxlength="1" oninput="quickSubmit(this)" class="w-full h-12 rounded-xl text-center text-3xl font-black text-black outline-none" placeholder="0">
            </div>
        </div>
    </div>

    <div class="scrollable-content space-y-4">
        <div>
            <div class="flex justify-between items-center px-2 mb-2">
                <h3 class="text-cyan-400 text-[10px] font-black uppercase italic">History Log Cards</h3>
                <button onclick="copyAnalysis()" class="bg-cyan-600 px-3 py-1 rounded-lg text-[10px] font-black uppercase shadow-lg">ðŸ“‹ Copy Log</button>
            </div>
            <div id="history-container" class="flex overflow-x-auto pb-2"></div>
        </div>

        <div class="px-2">
            <h3 class="text-yellow-500 text-[10px] font-black uppercase mb-2 italic">Pattern Intelligence (PIH)</h3>
            <div id="intel-log-container">
                <p id="no-intel" class="text-center text-gray-600 text-[10px] mt-10">NO PATTERNS ARCHIVED</p>
            </div>
        </div>

        <div class="px-2 pb-10">
            <button onclick="fullReset()" class="w-full py-3 bg-red-900/20 text-red-500 font-black rounded-xl uppercase text-[10px] border border-red-900/30">Reset All Data</button>
        </div>
    </div>

    <script>
        let history = [], intelLogs = [], roll = 1, stage = 1, pNext = "-", eNext = "-", sNext = "-";
        let activePattern = null;
        const inputEl = document.getElementById('digit-input');

        function quickSubmit(el) { if(el.value.length === 1) setTimeout(handleManualSubmit, 50); }

        function handleManualSubmit() {
            const val = inputEl.value.trim();
            if (val === "" || isNaN(val)) return;
            const num = parseInt(val);
            const grp = num >= 5 ? 'B' : 'S';
            inputEl.value = "";
            document.getElementById('highlight-g').innerText = num;
            detectAndRecord(grp); 
            processGame(num, grp);
            inputEl.focus();
        }

        function processGame(num, grp) {
            const entry = { val: num, grp, roll, stage, p: pNext, pOk: (pNext===grp), e: eNext, eOk: (eNext===grp), s: sNext, sOk: (sNext===grp) };
            history.push(entry);
            if(stage === 10) { roll++; stage = 1; } else { stage++; }
            updatePredictions();
            renderTable();
            save();
        }

        function detectAndRecord(nextGrp) {
            const hStr = history.map(h => h.grp).join('') + nextGrp;
            let found = false, label = "", count = 0, css = "", type = "";
            const alt = hStr.match(/((SB){3,}|(BS){3,})$/);
            const sMatch = hStr.match(/(B{4,}|S{4,})$/);
            const bbss = hStr.match(/((BBSS|SSBB)+(BB|SS|BBSS|SSBB)?)$/);

            if (alt) { found=true; type="alt"; label="á€á€…á€ºá€á€¯á€€á€»á€±á€¬á€ºá€…á€®"; count=alt[0].length; css="bg-purple-600"; }
            else if (sMatch) { found=true; type="streak"; label=sMatch[0][0]==='B'?"á€¡á€€á€¼á€®á€¸á€†á€€á€º":"á€¡á€žá€±á€¸á€†á€€á€º"; count=sMatch[0].length; css=sMatch[0][0]==='B'?"bg-red-600":"bg-green-600"; }
            else if (bbss && bbss[0].length >= 4) { found=true; type="bbss"; label="BBSS Pattern"; count=bbss[0].length; css="bg-orange-500"; }

            if (found) {
                activePattern = { type, label, count, css, roll, stage };
                showWarning(label, count, css);
            } else if (activePattern) {
                saveToIntel(activePattern);
                activePattern = null;
                hideWarning();
            }
        }

        function showWarning(label, count, css) {
            const div = document.getElementById('streak-warning');
            div.classList.remove('hidden');
            const box = document.getElementById('warning-box');
            box.innerText = `${label} - ${count}`;
            box.className = `py-1 px-4 rounded-full inline-block text-[10px] font-black uppercase text-white ${css}`;
        }

        function hideWarning() { document.getElementById('streak-warning').classList.add('hidden'); }

        function saveToIntel(p) {
            if (p.count >= 4) {
                intelLogs.unshift({ ...p, time: `R${p.roll} S${p.stage}` });
                renderIntel();
            }
        }

        function renderIntel() {
            const container = document.getElementById('intel-log-container');
            if (intelLogs.length > 0) document.getElementById('no-intel').style.display = 'none';
            container.innerHTML = intelLogs.map((l, index) => `
                <div class="flex items-center gap-2 mb-2 p-2 bg-white/5 rounded-lg border-l-4 ${l.css}">
                    <span class="text-[10px] font-black text-gray-500">#${intelLogs.length - index}</span>
                    <div class="flex-1">
                        <p class="text-[9px] font-bold opacity-70 uppercase">${l.label}</p>
                        <p class="text-[11px] font-black">${l.count} á€€á€¼á€­á€™á€ºá€™á€¼á€±á€¬á€€á€º á€€á€»á€­á€¯á€¸á€žá€½á€¬á€¸á€žá€Šá€º</p>
                    </div>
                    <span class="text-[8px] font-bold opacity-40">${l.time}</span>
                </div>`).join('');
        }

        function updatePredictions() {
            const lastVal = history[history.length-1].val;
            pNext = (lastVal % 2 === 0) ? 'S' : 'B';
            if (history.length >= 3) {
                const sum3 = history.slice(-3).reduce((a,b)=>a+b.val,0);
                eNext = (sum3 % 2 === 0) ? 'S' : 'B';
            }
            if (history.length >= 5) {
                let sum5 = history.slice(-5).reduce((a,b)=>a+b.val,0);
                while(sum5 >= 10) sum5 = sum5.toString().split('').map(Number).reduce((a,b)=>a+b,0);
                sNext = (sum5 % 2 !== 0) ? 'B' : 'S';
            }
            document.getElementById('pred-p').innerText = pNext;
            document.getElementById('pred-e').innerText = eNext;
            document.getElementById('pred-s').innerHTML = `<span>${sNext}</span>`;
        }

        function renderTable() {
            const container = document.getElementById('history-container');
            const rolls = history.reduce((acc, h) => { if(!acc[h.roll]) acc[h.roll]=[]; acc[h.roll].push(h); return acc; }, {});
            container.innerHTML = Object.keys(rolls).map(r => `
                <div class="roll-card">
                    <div class="text-[10px] font-black text-cyan-400 mb-2 border-b border-white/10 pb-1 flex justify-between"><span>ROLL ${r}</span> <span>Stg P PC E EC S SC G</span></div>
                    ${rolls[r].map(i => `
                        <div class="flex items-center justify-between text-[10px] py-1 border-b border-white/5 last:border-0">
                            <span class="w-3 font-bold text-gray-500">${i.stage}</span>
                            <span class="w-3 font-black">${i.p}</span><span class="${i.pOk?'status-ok':'status-no'}">${i.pOk?'âœ“':'âœ•'}</span>
                            <span class="w-3 font-black">${i.e}</span><span class="${i.eOk?'status-ok':'status-no'}">${i.eOk?'âœ“':'âœ•'}</span>
                            <span class="w-3 font-black">${i.s}</span><span class="${i.sOk?'status-ok':'status-no'}">${i.sOk?'âœ“':'âœ•'}</span>
                            <div class="g-num">${i.val}</div>
                        </div>`).join('')}
                </div>`).join('');
            container.scrollLeft = container.scrollWidth;
        }

        function copyAnalysis() {
            let log = "OMNI LOG V28\n";
            history.forEach(h => log += `R${h.roll}S${h.stage}: ${h.val} (P:${h.p}${h.pOk?'âœ“':'âœ•'} E:${h.e}${h.eOk?'âœ“':'âœ•'} S:${h.s}${h.sOk?'âœ“':'âœ•'})\n`);
            const el = document.createElement('textarea'); el.value = log; document.body.appendChild(el);
            el.select(); document.execCommand('copy'); document.body.removeChild(el);
            const t = document.getElementById('toast'); t.style.display='block'; setTimeout(()=>t.style.display='none', 1500);
        }

        function save() { localStorage.setItem('OMNI_V28_FINAL', JSON.stringify({ history, roll, stage, intelLogs })); }
        function load() {
            const d = JSON.parse(localStorage.getItem('OMNI_V28_FINAL'));
            if(d) { history=d.history; roll=d.roll; stage=d.stage; intelLogs=d.intelLogs||[]; renderTable(); renderIntel(); if(history.length>0) updatePredictions(); }
        }
        function fullReset() { if(confirm("Clear All?")) { localStorage.clear(); location.reload(); } }
        load(); inputEl.focus();
    </script>
</body>
</html>
