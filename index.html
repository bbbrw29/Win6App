<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Omni Logic - V30</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        html, body { background-color: #010816; color: white; height: 100%; font-family: 'Inter', sans-serif; overflow: hidden; touch-action: manipulation; }
        
        /* Layer Control */
        .header-layer { position: fixed; top: 0; left: 0; right: 0; z-index: 100; background: #010816; padding: 10px; border-bottom: 2px solid #00cfd5; }
        .main-scroller { margin-top: 280px; height: calc(100vh - 280px); overflow-y: auto; padding: 10px; -webkit-overflow-scrolling: touch; }

        /* Logic Boxes */
        .box-p { border: 3px solid #ff4136; color: #ff4136; border-radius: 50%; width: 42px; height: 42px; display: flex; align-items: center; justify-content: center; background: white; font-weight: 900; margin: 0 auto; }
        .box-e { border: 3px solid #b10dc9; color: #b10dc9; border-radius: 8px; width: 42px; height: 42px; display: flex; align-items: center; justify-content: center; background: white; font-weight: 900; margin: 0 auto; }
        .box-s { border: 3px solid #2ecc40; color: #2ecc40; border-radius: 6px; width: 38px; height: 38px; display: flex; align-items: center; justify-content: center; transform: rotate(45deg); background: white; font-weight: 900; margin: 0 auto; }
        .box-s span { transform: rotate(-45deg); }

        /* Performance Optimized History Card */
        .roll-card { flex-shrink: 0; width: 300px; background: #001d3d; border-radius: 1.5rem; padding: 12px; border: 1px solid #00cfd5; margin-right: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        .status-ok { color: #2ecc40; font-weight: 900; }
        .status-no { color: #ff4136; font-weight: 900; }
        .g-num { background: #ffdc00; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; color: black; font-weight: 900; border: 2px solid #000; }
        
        #pih-container { height: 140px; overflow-y: auto; background: rgba(255,255,255,0.03); border-radius: 1rem; border: 1px dashed #555; padding: 8px; }
        #toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #00cfd5; color: black; padding: 8px 20px; border-radius: 20px; font-weight: 900; display: none; z-index: 200; }
    </style>
</head>
<body>
    <div id="toast">COPIED SUCCESS!</div>

    <div class="header-layer space-y-3">
        <div class="flex justify-between items-center">
            <h1 class="text-xl font-black text-cyan-400 italic">OMNI V30 PRO</h1>
            <div id="warning-area" class="hidden">
                <div id="warning-box" class="px-4 py-1 rounded-full text-[10px] font-black uppercase text-white animate-pulse"></div>
            </div>
        </div>

        <div class="grid grid-cols-3 gap-3 bg-black/40 p-3 rounded-2xl border border-white/5">
            <div class="text-center"><p class="text-[9px] text-gray-500 font-bold mb-1 uppercase">P-Logic</p><div class="box-p" id="pred-p">-</div></div>
            <div class="text-center"><p class="text-[9px] text-gray-500 font-bold mb-1 uppercase">E-Logic</p><div class="box-e" id="pred-e">-</div></div>
            <div class="text-center"><p class="text-[9px] text-gray-500 font-bold mb-1 uppercase">S-Logic</p><div class="box-s" id="pred-s"><span>-</span></div></div>
        </div>

        <div class="flex gap-3 items-center">
            <div class="bg-black border-2 border-cyan-500 flex-1 h-16 rounded-2xl flex items-center justify-center text-5xl font-black text-cyan-400" id="current-digit">-</div>
            <input type="tel" id="digit-in" maxlength="1" oninput="engineStart(this)" class="w-24 h-16 rounded-2xl text-center text-4xl font-black text-black outline-none border-4 border-cyan-500" placeholder="?" autocomplete="off">
        </div>
    </div>

    <div class="main-scroller space-y-5">
        <section>
            <div class="flex justify-between items-center px-1 mb-2">
                <h3 class="text-cyan-400 text-[11px] font-black uppercase tracking-tighter italic">Live Rolling History</h3>
                <button onclick="copyData()" class="bg-cyan-500 text-black px-4 py-1.5 rounded-xl text-[10px] font-black uppercase active:scale-95 transition-transform">Copy Log</button>
            </div>
            <div id="cards-wrapper" class="flex overflow-x-auto pb-4 custom-scroll"></div>
        </section>

        <section class="px-1">
            <h3 class="text-yellow-500 text-[11px] font-black uppercase mb-2 italic">Pattern Archive (PIH)</h3>
            <div id="pih-container">
                <p id="pih-empty" class="text-center text-gray-600 text-[11px] mt-10">ANALYZING TRENDS...</p>
            </div>
        </section>

        <div class="pb-10">
            <button onclick="resetSystem()" class="w-full py-4 bg-red-600/10 text-red-500 font-black rounded-2xl uppercase text-[11px] border border-red-600/30">System Reset</button>
        </div>
    </div>

    <script>
        let db = { history: [], intel: [], roll: 1, stage: 1 };
        let nextP = "-", nextE = "-", nextS = "-";
        let tempPattern = null;

        const input = document.getElementById('digit-in');

        // Fast Entry Engine
        function engineStart(el) {
            if(el.value.length === 1) {
                const val = parseInt(el.value);
                if(!isNaN(val)) {
                    document.getElementById('current-digit').innerText = val;
                    processLogic(val);
                }
                el.value = "";
                setTimeout(() => input.focus(), 10);
            }
        }

        function processLogic(num) {
            const grp = num >= 5 ? 'B' : 'S';
            
            // 1. Detect Pattern
            analyzePattern(grp);

            // 2. Save Entry
            const entry = { val: num, grp, roll: db.roll, stage: db.stage, p: nextP, pOk: (nextP===grp), e: nextE, eOk: (nextE===grp), s: nextS, sOk: (nextS===grp) };
            db.history.push(entry);

            // 3. Update Counters
            if(db.stage === 10) { db.roll++; db.stage = 1; } else { db.stage++; }

            // 4. Async Updates
            updatePredictions();
            requestAnimationFrame(renderUI);
            saveData();
        }

        function analyzePattern(nextGrp) {
            const sequence = db.history.map(h => h.grp).join('') + nextGrp;
            const patterns = {
                alt: sequence.match(/((SB){3,}|(BS){3,})$/),
                streak: sequence.match(/(B{4,}|S{4,})$/),
                bbss: sequence.match(/((BBSS|SSBB)+(BB|SS|BBSS|SSBB)?)$/)
            };

            let matched = null;
            if(patterns.alt) matched = { type: 'alt', label: 'တစ်ခုကျော်စီ', count: patterns.alt[0].length, css: 'bg-purple-600' };
            else if(patterns.streak) matched = { type: 'streak', label: patterns.streak[0][0]==='B'?'အကြီးဆက်':'အသေးဆက်', count: patterns.streak[0].length, css: patterns.streak[0][0]==='B'?'bg-red-600':'bg-green-600' };
            else if(patterns.bbss && patterns.bbss[0].length >= 4) matched = { type: 'bbss', label: 'BBSS Pattern', count: patterns.bbss[0].length, css: 'bg-orange-500' };

            if(matched) {
                tempPattern = { ...matched, roll: db.roll, stage: db.stage };
                showWarning(matched);
            } else if(tempPattern) {
                db.intel.unshift({ ...tempPattern, end: `R${db.roll}S${db.stage}` });
                tempPattern = null;
                hideWarning();
                renderPIH();
            }
        }

        function renderUI() {
            const wrapper = document.getElementById('cards-wrapper');
            const grouped = db.history.reduce((acc, h) => { if(!acc[h.roll]) acc[h.roll]=[]; acc[h.roll].push(h); return acc; }, {});
            
            wrapper.innerHTML = Object.keys(grouped).map(r => `
                <div class="roll-card">
                    <div class="flex justify-between items-center border-b border-cyan-500/30 pb-2 mb-2">
                        <span class="text-[12px] font-black text-cyan-400">ROLL ${r}</span>
                        <span class="text-[8px] opacity-40 font-bold uppercase tracking-widest">Stg | P | E | S | G</span>
                    </div>
                    ${grouped[r].map(i => `
                        <div class="flex items-center justify-between py-2 border-b border-white/5 last:border-0">
                            <span class="text-[10px] font-bold text-gray-500">${i.stage}</span>
                            <div class="flex items-center gap-1.5 flex-1 justify-center">
                                <div class="flex flex-col items-center"><span class="text-[10px] font-black">${i.p}</span><span class="${i.pOk?'status-ok':'status-no'} text-[9px]">${i.pOk?'✓':'✕'}</span></div>
                                <div class="flex flex-col items-center"><span class="text-[10px] font-black">${i.e}</span><span class="${i.eOk?'status-ok':'status-no'} text-[9px]">${i.eOk?'✓':'✕'}</span></div>
                                <div class="flex flex-col items-center"><span class="text-[10px] font-black">${i.s}</span><span class="${i.sOk?'status-ok':'status-no'} text-[9px]">${i.sOk?'✓':'✕'}</span></div>
                            </div>
                            <div class="g-num">${i.val}</div>
                        </div>`).join('')}
                </div>`).join('');
            
            wrapper.scrollLeft = wrapper.scrollWidth;
        }

        function renderPIH() {
            const container = document.getElementById('pih-container');
            if(db.intel.length > 0) document.getElementById('pih-empty').style.display = 'none';
            container.innerHTML = db.intel.map((l, idx) => `
                <div class="flex items-center gap-3 mb-2 p-3 bg-white/5 rounded-xl border-l-4 ${l.css}">
                    <span class="text-[10px] font-black text-gray-600">#${db.intel.length - idx}</span>
                    <div class="flex-1">
                        <p class="text-[9px] font-bold opacity-50 uppercase">${l.label}</p>
                        <p class="text-[12px] font-black italic">${l.count} ကြိမ်မြောက်မှာ ကျိုးသည်</p>
                    </div>
                    <span class="text-[9px] font-black opacity-30">${l.end}</span>
                </div>`).join('');
        }

        function updatePredictions() {
            if(db.history.length === 0) return;
            const last = db.history[db.history.length-1].val;
            nextP = (last % 2 === 0) ? 'S' : 'B';
            if (db.history.length >= 3) {
                const s3 = db.history.slice(-3).reduce((a,b)=>a+b.val,0);
                nextE = (s3 % 2 === 0) ? 'S' : 'B';
            }
            if (db.history.length >= 5) {
                let s5 = db.history.slice(-5).reduce((a,b)=>a+b.val,0);
                while(s5 >= 10) s5 = s5.toString().split('').map(Number).reduce((a,b)=>a+b,0);
                nextS = (s5 % 2 !== 0) ? 'B' : 'S';
            }
            document.getElementById('pred-p').innerText = nextP;
            document.getElementById('pred-e').innerText = nextE;
            document.getElementById('pred-s').innerHTML = `<span>${nextS}</span>`;
        }

        function showWarning(m) {
            const area = document.getElementById('warning-area');
            area.classList.remove('hidden');
            const box = document.getElementById('warning-box');
            box.innerText = `${m.label} : ${m.count}`;
            box.className = `px-4 py-1 rounded-full text-[10px] font-black uppercase text-white animate-pulse ${m.css}`;
        }

        function hideWarning() { document.getElementById('warning-area').classList.add('hidden'); }

        function copyData() {
            let log = "OMNI V30 LOG\n";
            db.history.forEach(h => log += `R${h.roll}S${h.stage}: ${h.val} [P:${h.p}${h.pOk?'✓':'✕'} E:${h.e}${h.eOk?'✓':'✕'} S:${h.s}${h.sOk?'✓':'✕'}]\n`);
            const el = document.createElement('textarea'); el.value = log; document.body.appendChild(el);
            el.select(); document.execCommand('copy'); document.body.removeChild(el);
            const t = document.getElementById('toast'); t.style.display='block'; setTimeout(()=>t.style.display='none', 1500);
        }

        function saveData() { localStorage.setItem('OMNI_V30_DATABASE', JSON.stringify(db)); }
        function loadData() {
            const saved = JSON.parse(localStorage.getItem('OMNI_V30_DATABASE'));
            if(saved) { db = saved; renderUI(); renderPIH(); updatePredictions(); }
        }
        function resetSystem() { if(confirm("Clear all data and reset engine?")) { localStorage.clear(); location.reload(); } }

        window.onload = () => { loadData(); input.focus(); };
    </script>
</body>
</html>
