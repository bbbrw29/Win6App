<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Omni Logic PRO - AI Calculator Master</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pyidaungsu:wght@400;700&display=swap');
        body { 
            font-family: 'Pyidaungsu', sans-serif; 
            background-color: #010814; 
            color: white; 
            overflow-x: hidden; 
            -webkit-user-select: none; user-select: none; 
        }
        
        .fixed-header { position: fixed; top: 0; left: 0; right: 0; z-index: 100; background: #010814; padding: 10px; border-bottom: 1px solid #00f2ff44; }
        .main-content { margin-top: 320px; padding: 10px; padding-bottom: 100px; }
        
        .step-container { background: #0a192f; border: 1px solid #1e3a8a; border-radius: 12px; padding: 10px; margin-top: 10px; }
        .bet-box { background: #010814; border: 1px solid #1e293b; padding: 5px 2px; border-radius: 6px; text-align: center; transition: all 0.3s; }
        .bet-box.active { border-color: #10b981; background: #064e3b; box-shadow: 0 0 10px #10b98155; }
        .bet-input { width: 100%; background: transparent; color: white; font-size: 11px; font-weight: 900; text-align: center; border: none; outline: none; }
        
        .predict-box { width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; background: #fff; font-weight: 900; margin: 0 auto; font-size: 20px; border: 3px solid; }
        .a-box { border-color: #ff4136; color: #ff4136; border-radius: 50%; }
        .b-box { border-color: #b10dc9; color: #b10dc9; border-radius: 8px; }
        .c-box { border-color: #2ecc40; color: #2ecc40; border-radius: 4px; transform: rotate(45deg); }
        .c-box span { transform: rotate(-45deg); display: block; }

        .blur-locked { filter: blur(5px); opacity: 0.3; pointer-events: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

    <div id="auth-gate" class="fixed inset-0 z-[1000] bg-[#010814] flex items-center justify-center p-5 hidden">
        <div class="bg-[#0a192f] border-2 border-cyan-500 p-8 rounded-2xl text-center w-full max-w-sm shadow-[0_0_30px_#00f2ff33]">
            <h2 class="text-cyan-400 font-black text-2xl mb-2 italic">OMNI LOGIC <span class="text-white">PRO</span></h2>
            <p id="auth-msg" class="text-gray-400 text-[10px] mb-6 uppercase tracking-widest">Activation Required</p>
            <input type="tel" id="activation-code" class="w-full p-4 bg-black border-2 border-cyan-500 text-cyan-400 text-center text-2xl font-black rounded-xl mb-4 outline-none" placeholder="------">
            <button onclick="handleActivation()" id="btn-text" class="w-full p-4 bg-cyan-500 text-black font-black rounded-xl shadow-lg active:scale-95 transition-all">ACTIVATE NOW</button>
            <p class="mt-6 text-[9px] text-gray-600 uppercase font-bold">DEVICE ID: <span id="hw-display"></span></p>
        </div>
    </div>

    <div id="main-ui" class="hidden">
        <div class="fixed-header">
            <div class="flex justify-between items-center px-2 mb-3">
                <div class="flex flex-col">
                    <span id="user-status" class="text-[10px] font-black text-yellow-400 uppercase tracking-tighter">üíé VIP MEMBER</span>
                    <span id="hw-id-small" class="text-[8px] text-slate-500 font-mono italic">ID: --</span>
                </div>
                <div class="text-right">
                    <span id="expiry-display" class="text-[10px] font-bold text-red-400">EXP: --</span>
                </div>
            </div>

            <div class="grid grid-cols-3 gap-2 text-center mb-4">
                <div>
                    <div class="text-[10px] text-gray-500 font-black mb-1 italic">LOGIC A</div>
                    <div class="predict-box a-box" id="box-a">-</div>
                </div>
                <div class="relative">
                    <div class="text-[10px] text-gray-500 font-black mb-1 italic">LOGIC B</div>
                    <div id="container-b"><div class="predict-box b-box" id="box-b">-</div></div>
                </div>
                <div class="relative">
                    <div class="text-[10px] text-gray-500 font-black mb-1 italic">LOGIC C</div>
                    <div id="container-c"><div class="predict-box c-box" id="box-c"><span>-</span></div></div>
                </div>
            </div>

            <div class="step-container">
                <div class="flex justify-between items-center mb-2 px-1">
                    <select id="step-count" onchange="changeMaxSteps(this.value)" class="bg-transparent text-cyan-400 text-[10px] font-black outline-none border border-slate-700 rounded px-1">
                        <option value="5">5 STEPS</option>
                        <option value="8" selected>8 STEPS</option>
                    </select>
                    <span id="total-budget-display" class="text-[10px] font-black text-yellow-400">TOTAL: 0</span>
                </div>
                <div id="dynamic-step-grid" class="flex gap-1 overflow-x-auto no-scrollbar mb-3"></div>
                <div class="flex gap-2">
                    <button onclick="nextStep()" class="flex-1 bg-emerald-600 py-2 rounded font-black text-[11px] active:scale-95">NEXT STEP</button>
                    <button onclick="resetSteps()" class="w-12 bg-slate-800 py-2 rounded font-black text-[11px] text-red-500 active:scale-95">R</button>
                </div>
            </div>

            <div class="flex gap-2 items-center justify-center mt-3 bg-black/40 p-2 rounded-xl border border-white/5">
                <input type="tel" id="digit-input" class="w-16 h-10 rounded-lg text-center text-2xl font-black text-black border-2 border-cyan-500 outline-none" maxlength="1">
                <button onclick="submitDigit()" class="bg-cyan-500 text-black h-10 flex-1 rounded-lg font-black active:scale-95">SUBMIT</button>
            </div>
        </div>

        <div class="main-content">
            <div id="history-container" class="flex flex-col gap-3"></div>
            <button onclick="fullReset()" class="w-full mt-6 p-3 bg-red-900/20 rounded-lg text-[10px] font-black text-red-500 border border-red-900/40 uppercase">Clear Records</button>
        </div>
    </div>

    <script>
        const SB_URL = "https://folxuczagcspjnypyopw.supabase.co";
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZvbHh1Y3phZ2NzcGpueXB5b3B3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYzMjQ4MTAsImV4cCI6MjA4MTkwMDgxMH0.gOwmroH4rGr1iGATXK1NoSfg7gNs87hXJ8E3w13s5xo";
        
        let history = [], roll = 1, stage = 1;
        let currentStep = 0;
        let maxSteps = 8;
        let betValues = JSON.parse(localStorage.getItem('omni_bets')) || [100, 200, 400, 800, 1600, 3200, 6400, 12800];
        let isVIP = false;

        function getHWID() {
            const raw = screen.width + "-" + screen.height + "-" + (navigator.hardwareConcurrency || 4);
            let hash = 0;
            for (let i = 0; i < raw.length; i++) hash = ((hash << 5) - hash) + raw.charCodeAt(i);
            return "ID-" + Math.abs(hash).toString(36).toUpperCase();
        }
        const deviceId = getHWID();
        document.getElementById('hw-display').innerText = deviceId;
        document.getElementById('hw-id-small').innerText = "ID: " + deviceId;

        async function checkAccess() {
            try {
                const res = await fetch(`${SB_URL}/rest/v1/user_access?device_id=eq.${deviceId}`, {
                    headers: { "apikey": SB_KEY, "Authorization": `Bearer ${SB_KEY}` }
                });
                const data = await res.json();
                if (data && data.length > 0) {
                    const expiry = new Date(data[0].expires_at);
                    if (expiry > new Date()) {
                        document.getElementById('main-ui').classList.remove('hidden');
                        document.getElementById('auth-gate').classList.add('hidden');
                        document.getElementById('expiry-display').innerText = "EXP: " + expiry.toLocaleDateString();
                        
                        const diffDays = Math.ceil((expiry - new Date()) / (1000 * 60 * 60 * 24));
                        isVIP = diffDays > 6; 
                        document.getElementById('user-status').innerText = isVIP ? "üíé VIP MEMBER" : `üïí TRIAL: ${diffDays} DAYS`;
                        
                        if(!isVIP) {
                            document.getElementById('container-b').classList.add('blur-locked');
                            document.getElementById('container-c').classList.add('blur-locked');
                        }
                    } else { document.getElementById('auth-gate').classList.remove('hidden'); }
                } else { document.getElementById('auth-gate').classList.remove('hidden'); }
            } catch (e) { document.getElementById('auth-gate').classList.remove('hidden'); }
        }

        async function handleActivation() {
            const code = document.getElementById('activation-code').value.trim();
            const btn = document.getElementById('btn-text');
            if (code.length < 6) return;
            
            btn.innerText = "CHECKING...";
            try {
                const res = await fetch(`${SB_URL}/rest/v1/pending_codes?code_key=eq.${code}`, {
                    headers: { "apikey": SB_KEY, "Authorization": `Bearer ${SB_KEY}` }
                });
                const data = await res.json();

                if (data.length > 0) {
                    const saveRes = await fetch(`${SB_URL}/rest/v1/user_access`, {
                        method: 'POST',
                        headers: { 
                            "apikey": SB_KEY, 
                            "Authorization": `Bearer ${SB_KEY}`, 
                            "Content-Type": "application/json",
                            "Prefer": "return=minimal"
                        },
                        body: JSON.stringify({ 
                            device_id: deviceId, 
                            telegram_id: data[0].tg_id || "USER", 
                            expires_at: data[0].expires_at 
                        })
                    });

                    if (saveRes.ok) {
                        // Delete used code
                        await fetch(`${SB_URL}/rest/v1/pending_codes?code_key=eq.${code}`, {
                            method: 'DELETE',
                            headers: { "apikey": SB_KEY, "Authorization": `Bearer ${SB_KEY}` }
                        });
                        alert("Activated Successfully!");
                        location.reload();
                    }
                } else { 
                    alert("Invalid Code!"); 
                    btn.innerText = "ACTIVATE NOW";
                }
            } catch (e) { 
                alert("Server Connection Error!"); 
                btn.innerText = "ACTIVATE NOW";
            }
        }

        function renderSteps() {
            const grid = document.getElementById('dynamic-step-grid');
            const budgetDisp = document.getElementById('total-budget-display');
            grid.innerHTML = '';
            let total = 0;
            for(let i=0; i<maxSteps; i++) {
                total += (betValues[i] || 0);
                grid.innerHTML += `
                    <div class="bet-box ${i === currentStep ? 'active' : 'opacity-30'}">
                        <div class="text-[7px] text-gray-500 font-bold">S${i+1}</div>
                        <input type="number" value="${betValues[i]}" onchange="updateBet(${i}, this.value)" class="bet-input">
                    </div>
                `;
            }
            budgetDisp.innerText = "TOTAL: " + total.toLocaleString();
        }

        function updateBet(i, val) {
            betValues[i] = parseInt(val) || 0;
            localStorage.setItem('omni_bets', JSON.stringify(betValues));
            renderSteps();
        }

        function nextStep() { currentStep = (currentStep + 1) % maxSteps; renderSteps(); }
        function resetSteps() { currentStep = 0; renderSteps(); }
        function changeMaxSteps(v) { maxSteps = parseInt(v); currentStep = 0; renderSteps(); }

        function submitDigit() {
            const input = document.getElementById('digit-input');
            const val = parseInt(input.value);
            if (isNaN(val)) return;
            const grp = val >= 5 ? 'B' : 'S';
            const aNext = history.length > 0 ? (history[history.length-1].grp === 'B' ? 'S' : 'B') : 'B';
            history.push({ val, grp, roll, stage, aNext, aOk: aNext === grp });
            if (stage === 10) { roll++; stage = 1; } else { stage++; }
            input.value = ""; renderHistory(); 
            document.getElementById('box-a').innerText = aNext;
            localStorage.setItem('omni_history', JSON.stringify({history, roll, stage}));
        }

        function renderHistory() {
            const container = document.getElementById('history-container');
            container.innerHTML = history.slice().reverse().map(i => `
                <div class="bg-[#0a192f] p-3 rounded-xl border border-white/5 flex justify-between items-center shadow-lg">
                    <div class="flex flex-col">
                        <span class="text-[9px] text-slate-500 font-bold uppercase italic tracking-widest">R${i.roll} STAGE ${i.stage}</span>
                        <span class="text-lg font-black ${i.aOk ? 'text-green-400' : 'text-red-500'}">LOGIC A: ${i.aNext} ${i.aOk ? '‚úÖ' : '‚ùå'}</span>
                    </div>
                    <div class="text-2xl font-black text-cyan-400 drop-shadow-md">${i.val}</div>
                </div>
            `).join('');
        }

        function fullReset() { if(confirm("Clear all data?")) { localStorage.clear(); location.reload(); } }

        window.onload = () => {
            checkAccess();
            renderSteps();
            const saved = JSON.parse(localStorage.getItem('omni_history'));
            if(saved) { 
                history=saved.history; roll=saved.roll; stage=saved.stage; 
                renderHistory();
                if(history.length > 0) document.getElementById('box-a').innerText = history[history.length-1].aNext;
            }
        };
    </script>
</body>
</html>
